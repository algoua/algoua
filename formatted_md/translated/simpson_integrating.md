# Интегрирование по формулою Сімпсона

Потрібно порахувати значення определённого интеграла:

$$ \int_a^b f(x) dx $$

Розв'язок, описываемое тут, було опубликовано в однієї з диссертаций **Томаса Сімпсона** (Thomas Simpson) в 1743 р.

## Формула Сімпсона

Нехай $n$ - деякий натуральне число. Розіб'Ємо відрізок интегрирования $[a;b]$ на $2n$ рівних частин:

$$ x_i = a + i h,~~i = 0 \ldots 2n, $$
$$ h = \frac{ b-a }{ 2n }. $$

Тепер порахуємо интеграл окремо на кожному з відрізків $[x_{2i-2}, x_{2i}], i = 1 \ldots n$, а потім сложим всі значення.

Отже, нехай ми розглядаємо черговий відрізок $[x_{2i-2}, x_{2i}], i = 1 \ldots n$. Заменим функцію $f(x)$ на ньому параболой, що проходити через 3 точки $(x_{2i-2},x_{2i-1},x_{2i})$. Така парабола завжди існує і единственна. Її можна знайти аналітично, потім залишиться тільки проинтегрировать вираз для її, і остаточно отримуємо:

$$ \int_{x_{2i-2}}^{x_{2i}} f(x) dx = \left( f(x_{2i-2}) + 4 f(x_{2i-1}) + f(x_{2i}) \right) \frac{ h }{ 3 }. $$

Складывая ці значення по всім відрізках, отримуємо окончательную **формулу Сімпсона**:

$$ \int_a^b f(x) dx = \left( f(x_0) + 4 f(x_1) + 2 f(x_2) + 4 f(x_3) + 2 f(x_4) + \ldots + 4 f(x_{2N-1}) + f(x_{2N}) \right) \frac{ h }{ 3 }. $$

## Погрешность

Погрешность, даваемая формулою Сімпсона, не перевершує за модулем величини:

$$ \frac{ 1 }{ 180 } h^4 (b - a) \max_{a \le x \le b} \left| f^{(4)}(x) \right|. $$

Таким чином, похибка має порядок зменшення як $O(n^4)$.

## Реалізація

Тут $f(x)$ - деяка пользовательская функція.

<!--- TODO: specify code snippet id -->
``` cpp
double a, b; // вхідні дані
const int N = 1000*1000; // кількість кроків (вже помножене на 2)
double s = 0;
double h = (b - a) / N;
for (int i=0; i<=N; ++i) {
    double x = a + h * i;
    s += f(x) * ((i==0 || i==N) ? 1 : ((i&1)==0) ? 2 : 4);
}
s *= h / 3;
```
