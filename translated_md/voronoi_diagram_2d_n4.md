# Діаграма Вороного в 2D

## Визначення

Дано $n$ точок $P_i(x_i,y_i)$ на площині. Розглянемо розбиття площині на $n$ областей $V_i$ (называемых многоугольниками Вороного або ячейками Вороного, іноді - многоугольниками близости, ячейками Дирихле, разбиением Тиссена), де $V_i$ - множину всіх точок площині, які знаходяться ближче до точці $P_i$, ніж до всім іншим точкам $P_k$:

$$
V_i = \{ (x,y): \rho ((x,y), P_i) = \min_{ k = 1 \ldots N } \rho ((x,y), P_k) \}
$$

Саме розбиття площині називається диаграммой Вороного даного набору точок $P_k$.

Тут $\rho(p,q)$ - задана метрика, зазвичай це стандартна Евклидова метрика: $\rho(p,q) = \sqrt{ (x_p-x_q)^2 + (y_p-y_q)^2 }$, однак нижче буде розглянуто і випадок так званої манхэттенской метрики. Тут і далі, якщо не оговорено іншого, буде розглядатися випадок Евклидовой метрики

Ячейки Вороного являють собою выпуклые багатокутники, деякі є бесконечными. Точки, належать згідно визначенню зразу кільком осередкам Вороного, зазвичай так і относят зразу до кільком осередкам (в випадку Евклидовой метрики множину таких точок має меру нуль; в випадку манхэттенской метрики усе декілька складніше).

Такие багатокутники вперше були глубоко изучены русским математиком Вороным (1868-1908 гг)..

## Властивості

* Діаграма Вороного є планарним графом, тому вона має $O(n)$ вершин і ребер.

* Зафіксуємо будь-яке $i=1 \ldots n$. Значить для кожного $j=1 \ldots n, j \ne i$ проведемо пряму - серединный перпендикуляр відрузку $(P_i,P_j)$; розглянемо ту полуплоскость, образуемую цій прямої, в якій лежить точка $P_i$. Значить перетин всіх полуплоскостей для кожного $j$ дасть осередок Вороного $P_i$.

* Кожна вершина діаграми Вороного є центром кола, проведённой через які-або три точки множини $P$. Ці кола істотно використовуються у багатьох доказательствах, пов'язаних з диаграммами Вороного.

* Ячейка Вороного $V_i$ є нескінченної тоді і тільки тоді, коли точка $P_i$ лежить на кордоні опуклою оболонки множини $P_k$.

* Розглянемо граф, двоїстий до діаграмі Вороного, тобто в цим графі вершинами будуть точки $P_i$, а ребро проводиться між точками $P_i$ і $P_j$, якщо їх осередки Вороного $V_i$ і $V_j$ мають загальне ребро. Значить, при умови, що ніякі чотири точки не лежати на однієї кола, двоїстий до діаграмі Вороного граф є триангуляцией Делоне (обладающей безліччю цікавих властивостей).

## Застосування

Діаграма Вороного представляє собою компактную структуру данних, хранящую всю необхідну інформацію для розв'язку множини задач про близости.

В рассмотренных нижче завданнях час, необхідне на побудова самою діаграми Вороного, в асимптотиках не учитывается.

* Знаходження найближчій точки для кожної.

Відзначимо простий факт: якщо для точки $P_i$ найближчій є точка $P_j$, то ця точка $P_j$ має "своє" ребро в осередку $V_i$. Звідси випливає, що, аби знайти для кожної точки найближчу до ній, достатньо переглянути ребра її осередки Вороного. Однак кожне ребро належить рівне двом осередкам, тому буде переглянуто рівне два рази, і вследствие лінійності числа ребер ми отримуємо розв'язок даній задачі за $O(n)$.

* Знаходження опуклою оболонки.

Згадаймо, що вершина належить опуклою оболочке тоді і тільки тоді, коли її комірка Вороного бесконечна. Значить найдемо в діаграмі Вороного будь-яке нескінченне ребро, і начнём рухатися в якому-або фіксованому напрямку (наприклад, проти годинний стрілки) по осередку, містить це ребро, поки не дійдемо до наступного нескінченного ребра. Значить перейдемо через це ребро в соседнюю осередок і продовжимо обхід. В результаті всі просмотренные ребра (крім бесконечных) будуть бути сторонами шуканої опуклою оболонки. Очевидно, час роботи алгоритму - $O(n)$.

* Знаходження Евклидова мінімального остовного дерева.

Потрібно знайти мінімальне каркасне дерево з вершинами в данних точках $P$, соединяющее всі ці точки. Якщо застосовувати стандартні методи теорії графів, то, т.до. граф в даному випадку має $O(n^2)$ ребер, навіть оптимальний алгоритм буде мати не меншу асимптотику.

Розглянемо граф, двоїстий діаграмі Вороного, тобто триангуляцию Делоне. Можна показати, що знаходження Евклидова мінімального острови еквівалентно побудови острови тріангуляції Делоне. Дійсно, в [алгоритмі Прима](mst_prim) кожний раз шукається найкоротший ребро між двома можествами точок; якщо ми зафіксуємо точку одного множини, то ближайшая до ній точка має ребро в осередку Вороного, тому в тріангуляції Делоне буде бути присутнім ребро до найближчій точці, що і потрібно довести.

Триангуляция є планарним графом, тобто має лінійне число ребер, тому до ній можна застосувати [алгоритм Крускала](mst_kruskal_with_dsu) і получити алгоритм з часом роботи $O(n \log n)$.

* Знаходження найбільшою порожній кола.

Потрібно знайти коло найбільшого радіусу, не що містить всередині никакую з точок $P_i$ (центр кола повинен лежати всередині опуклою оболонки точок $P_i$). Зауважимо, що, т.до. функція найбільшого радіусу кола в даній точці $f(x,y)$ є строго монотонной всередині кожної осередки Вороного, то вона досягає свого максимуму в однієї з вершин діаграми Вороного, або в точці перетину ребер діаграми і опуклою оболонки (а число таких точок не більш ніж в два рази більше числа ребер діаграми). Таким чином, залишається тільки перебрати зазначені точки і для кожної знайти найближчу, тобто розв'язок за $O(n)$.

## Простий алгоритм побудови діаграми Вороного за $O(n^4)$

Диаграммы Вороного - достатньо добре изученный об'єкт, і для них отримано множину різних алгоритмів, працюючих за оптимальную асимптотику $O(n \log n)$, а деякі з цих алгоритмів навіть працюють в середньому за $O(n)$. Однак всі ці алгоритми вельми складні.

Розглянемо тут самий простий алгоритм, заснований на приведённом вище свойстве, що кожна комірка Вороного представляє собою перетин полуплоскостей. Зафіксуємо $i$. Проведемо між точкою $P_i$ і кожної точкою $P_j$ пряму - серединный перпендикуляр, потім пересечём попарно всі отримані прямі - отримаємо $O(n^2)$ точок, і кожну перевіримо на належність всім $n$ полуплоскостям. В результаті за $O(n^3)$ дій ми отримаємо всі вершини осередки Вороного $V_i$ (їх вже буде не більш $n$, тому ми можемо без ухудшения асимптотики відсортувати їх по полярному розі), а всього на побудова діаграми Вороного буде потрібно $O(n^4)$ дій.

## Випадок особой метрики

Розглянемо наступну метрику:

$$
\rho(p,q) = \max (|x_p-x_q|, |y_p-y_q|)
$$

Начать розгляд випливає з разбора простейшего випадку - випадку двох точок $A$ і $B$.

Якщо $A_x=B_x$ або $A_y=B_y$, то диаграммой Вороного для них буде відповідно вертикальна або горизонтальная пряма.

Інакше диаграмма Вороного буде мати вид "уголка": відрізок під углом $45$ градусов в прямокутнику, образованном точками $A$ і $B$, і горизонтальные/вертикальні лучи з його кінців в залежності від того, длиннее або вертикальна сторона прямокутника або горизонтальная.

Особый випадок - коли цей прямокутник має однакову довжину і ширину, тобто $|A_x-B_x| = |A_y-B_y|$. В цим випадку будуть иметься дві нескінченні області ("уголки", образованные двома лучами, паралельними осях), які по визначенню повинні належати зразу обеим осередкам. В такому випадку додатково определяют в умови, як випливає розуміти ці області (іноді искусственно вводят правило, по якому кожний уголок относят до своєї осередку).

Таким чином, вже для двох точок диаграмма Вороного в даній метрике представляє собою нетривиальный об'єкт, а в випадку більшого числа точок ці фігури треба буде вміти швидко пересекать.
