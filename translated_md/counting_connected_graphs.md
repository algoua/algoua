<h2>Кількість помічених графів

Дано число $N$ вершин. Потрібно порахувати кількість $G_N$ різних помічених графів з $N$ вершинами (тобто вершини графа позначені різними числами від $1$ до $N$, і графи сравниваются з урахуванням цій фарбування вершин). Рёбра графа неориентированы, петлі і кратні ребра запрещены.

Розглянемо множину всіх можливих ребер графа. Для будь-якого ребра $(i,j)$ покладемо, що $i<j$ (грунтуючись на неориентированности графа і отсутствии петель). Значить множину всіх можливих ребер графа має потужність $C_N^2$, тобто $\frac{ N (N-1) }{ 2 }$.

Оскільки будь-який помеченный граф однозначно визначається своїми ребрами, то кількість помічених графів з $N$ вершинами рівне:

$$
G_N = 2^{ \frac{ N (N-1) }{ 2 } }
$$

## Кількість зв'язаних помічених графів

За порівняно з попередньою завданням ми додатково накладываем обмеження, що граф повинен бути зв'язним.

Позначимо шукане число через $Conn_N$.

Навчимося, навпаки, вважати кількість **незв'язних** графів; тоді кількість зв'язаних графів вийде як $G_N$ мінус знайдене число. Більш того, навчимося вважати кількість **кореневих** (тобто з выделенной вершиною - коренем) **незв'язних графів**; тоді кількість незв'язних графів буде виходити з нього делением на $N$. Зауважимо, що, так як граф несвязный, то в ньому знайдеться компонента зв'язності, всередині якій лежить корінь, а остальной граф буде представляти собою ще декілька (як мінімум одну) компонент зв'язності.

Переберемо кількість $K$ вершин в цій компоненті зв'язності, містить корінь (очевидно, $K = 1 \ldots N-1$), і найдемо кількість таких графів. По-перше, ми повинні вибрати $K$ вершин з $N$, тобто відповідь множиться на $C_N^K$. По-друге, компонента зв'язності з коренем дає множник $Conn_K$. По-третє, залишився граф з $N-K$ вершин є довільним графом, а тому він дає множник $G_{N-K}$. Нарешті, кількість способів виділити корінь в компоненті зв'язності з $K$ вершин рівне $K$. Разом, при фіксованому $K$ кількість **кореневих незв'язних** графів рівне:

$$
K\ C_N^K\ Conn_K\ G_{N-K}
$$

Значить, кількість **незв'язних** графів з $N$ вершинами рівне:

$$
\frac{1}{N} \sum_{K=1}^{N-1} K\ C_N^K\ Conn_K\ G_{N-K}
$$

Нарешті, шукане кількість **зв'язаних** графів рівне:

$$
Conn_N = G_N - \frac{1}{N} \sum_{K=1}^{N-1} K\ C_N^K\ Conn_K\ G_{N-K}
$$

## Кількість помічених графів з $K$ компонентами зв'язності

Основываясь на попередньою формулою, навчимося вважати кількість помічених графів з $N$ вершинами і $K$ компонентами зв'язності.

Сделать це можна з допомогою динамічного програмування. Навчимося вважати **$D[N][K]$** - кількість помічених графів з $N$ вершинами і $K$ компонентами зв'язності.

Навчимося обчислювати черговий елемент $D[N][K]$, знаючи попередні значення. Скористаємося стандартним прийомом при рішенні таких задач: візьмемо вершину з номером 1, вона належить якийсь компоненті, ось цю компоненту ми і будемо перебирати. Переберемо розмір $S$ цій компоненти, тоді кількість способів вибрати таке множину вершин рівне $C_{N-1}^{S-1}$ (одну вершину - вершину 1 - перебирати не треба). Кількість ж способів побудувати компоненту зв'язності з $S$ вершин ми вже вміємо вважати - це $Conn_S$. Після видалення цій компоненти з графа у нас залишається граф з $N-S$ вершинами і $K-1$ компонентами зв'язності, тобто ми отримали рекурентну залежність, по якій можна обчислювати значення $D[][]$:

$$
D[N][K] = \sum_{S=1}^{N} C_{N-1}^{S-1}\ Conn_S\ D[N-S][K-1]
$$

Разом отримуємо приблизно такий код:
<!--- TODO: specify code snippet id -->
``` cpp
int d[n+1][k+1]; // спершу заполнен нулями
d[0][0][0] = 1;
for (int i=1; i<=n; ++i)
    for (int j=1; j<=i && j<=k; ++j)
        for (int s=1; s<=i; ++s)
            d[i][j] += C[i-1][s-1] * conn[s] * d[i-s][j-1];
cout << d[n][k][n];
```

Зрозуміло, на практиці, швидше всього, потрібна буде [довга арифметика](big_integer).
