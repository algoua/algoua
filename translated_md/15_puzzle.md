# Гра П'ятнашки: існування розв'язку

Нагадаємо, що гра представляє собою поле $4$ на $4$, на якому розташовані $15$ фишек, пронумерованных числами від $1$ до $15$, а одне поле оставлено порожнім. Потрібно, пересуваючи на кожному кроці яку-або фішку на вільну позицію, прийти в наприкінці кінців до наступного позиції:

$$
\matrix{
1&2&3&4\cr
5&6&7&8\cr
9&10&11&12\cr
13&14&15&\bigcirc\cr
}
$$

Игру П'ятнашки ("15 puzzle") винайшов в 1880 р. Нойес Чэпман (Noyes Chapman).

## Существование розв'язку

Тут ми розглянемо таку задачу: по даній позиції на дошці сказати, існує або послідовність ходів, приводящая до розв'язку, або ні.

Нехай дана деяка позиція на дошці:

$$
\matrix{
a_1 & a_2 & a_3 & a_4 \cr 
a_5 & a_6 & a_7 & a_8 \cr 
a_9 & a_{10} & a_{11} & a_{12} \cr 
a_{13} & a_{14} & a_{15} & a_{16} \cr 
}
$$

де один з елементів рівний нулю і позначає пусту клітинку $a_z = 0$.

Розглянемо перестановку:

$$
a_1 a_2 \ldots a_{z-1} a_{z+1} \ldots a_{15} a_{16}
$$

(тобто перестановка чисел, відповідна позиції на дошці, без нульового елементу)

Позначимо через $N$ кількість инверсий в цій перестановки (тобто кількість таких елементів $a_i$ і $a_j$, що $i < j$, але $a_i > a_j$).

Далі, нехай $K$ - номер стрічки, в якій знаходиться порожній елемент (тобто в наших позначеннях $K = (z-1)\ {\rm div}\ 4 + 1)$.

Значить, **розв'язок існує тоді і тільки тоді, коли $N+K$ парне**.

## Реалізація

Проиллюстрируем зазначений вище алгоритм з допомогою программного коду:
<!--- TODO: specify code snippet id -->
``` cpp
int a[16];
for (int i=0; i<16; ++i)
    cin >> a[i];

int inv = 0;
for (int i=0; i<16; ++i)
    if (a[i])
        for (int j=0; j<i; ++j)
            if (a[j] > a[i])
                ++inv;
for (int i=0; i<16; ++i)
    if (a[i] == 0)
        inv += 1 + i / 4;

puts ((inv & 1) ? "No Solution" : "Solution Exists");
```

## Доведення

Джонсон (Johnson) в 1879 р. довів, що якщо $N+K$ непарне, то розв'язку не існує, а Стори (Story) в тому ж році довів, що всі позиції, для яких $N+K$ парне, мають розв'язок.

Однак обидва ці доведення були достатньо складні.

В 1999 р. Арчер (Archer) запропонував значно більш просте доведення (завантажити його статтю можна [тут](http://www.cs.cmu.edu/afs/cs/academic/class/15859-f01/www/notes/15-puzzle.pdf)).
