# Намиста

Задача "ожерелья" - це одна з класичних комбінаторних задач. Потрібно порахувати кількість різних намист з $n$ бусинок, кожна з яких можливо бути пофарбована в один з $k$ квітів. При порівняно двох намист їх можна повертати, але не перевертати (тобто дозволяється зробити циклічний зсув).

## Розв'язок

Решить цю задачу можна, використовуючи [лему Бернсайда і теорему Пойа](burnside_polya). [ Нижче йде копия тексту з цій статті ]

В цій задачі ми можемо зразу знайти групу інваріантних перестановок. Очевидно, вона буде складатися з $n$ перестановок:

$$
\pi_0 = 1\ 2\ 3\ \ldots\ n
$$

$$
\pi_1 = 2\ 3\ \ldots\ n\ 1
$$

$$
\pi_2 = 3\ \ldots\ n\ 1\ 2
$$

$$
\ldots
$$

$$
\pi_{n-1} = n\ 1\ 2\ \ldots\ (n-1)
$$

Знайдемо явну формулу для обчислення $C(\pi_i)$. По-перше, зауважимо, що перестановки мають такий вид, що в $i$-ой перестановки на $j$-ой позиції варто $i+j$ (взятое за модулем $n$, якщо воно більше $n$). Якщо ми будемо розглядати циклическую структуру $i$-ой перестановки, то побачимо, що одиниця переходити в $1+i$, $1+i$ переходити в $1+2i$, $1+2i$ - в $1+3i$, і т.д., поки не прийдемо в число $1 + kn$; для інших елементів виконуються схожі затвердження. Звідси можна зрозуміти, що всі цикли мають однакову довжину, рівну ${\rm lcm}(i,n) / i$, тобто $n / {\rm gcd}(i,n)$ ("gcd" - найбільший загальний дільник, "lcm" - найменше загальне кратне). Значить кількість циклів в $i$-ой перестановки буде рівне просто ${\rm gcd}(i,n)$.

Підставляючи знайдені значення в теорему Пойа, отримуємо **розв'язок**:

$$
{\rm Ans} = \frac{1}{n} \sum_{i=1}^{n} k ^ {{\rm gcd}(i,n)}
$$

Можна залишити формулу в такому вигляді, а можна її свернуть ще більше. Перейдемо від суми по всім $i$ до сумі тільки по дільникам $n$. Дійсно, в нашій сумі буде багато однакових доданків: якщо $i$ не є дільником $n$, то такий дільник знайдеться після обчислення ${\rm gcd}(i,n)$. Отже, для кожного подільника $d|n$ його доданок $k^{{\rm gcd}(d,n)} = k^d$ врахує декілька раз, тобто суму можна уявити в такому вигляді:

$$
{\rm Ans} = \frac{1}{n} \sum_{d|n} C_d k^d
$$

де $C_d$ - це кількість таких чисел $i$, що ${\rm gcd}(i,n) = d$. Знайдемо явне вираз для цього кількості. Будь-яке таке число $i$ має вид: $i=dj$, де ${\rm gcd}(j,n/d) = 1$ (інакше було б ${\rm gcd}(i,n) > d$). Згадуючи [функцію Ейлера](euler_function), ми знаходимо, що кількість таких $j$ - це величина функції Ейлера $\phi(n/d)$. Таким чином, $C_d = \phi(n/d)$, і остаточно отримуємо **формулу**:

$$
{\rm Ans} = \frac{1}{n} \sum_{d|n} \phi \left( \frac{n}{d} \right) k^d
$$
