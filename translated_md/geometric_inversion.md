# Перетворення геометричній інверсії

Перетворення геометричній інверсії (inversive geometry) - це особливий тип перетворення точок на площині. Практическая польза цього перетворення в тому, що найчастіше воно дозваляє звести розв'язок геометричній задачі **з колами** до розв'язку відповідної задачі **з прямими**, яка зазвичай має набагато більш просте розв'язок.

За всій видимості, основоположником цього напрямку математики був Людвиг Иммануэль Магнус (Ludwig Immanuel Magnus), який в 1831 р. опублікував статтю про инверсных преобразованиях.

## Визначення

Зафіксуємо коло з центром в точці $O$ радіусу $r$. Значить **инверсией** точки $P$ щодо цій кола називається така точка $P^\prime$, яка лежить на луче $OP$, а на відстань накладено умова:

$$
OP \cdot OP^\prime = r^2.
$$

\img{inversion_3.png}

Якщо вважати, що центр $O$ кола збігається з початком координат, то можна сказати, що точка $P^\prime$ має той ж полярний кут, що і $P$, а відстань обчислюється по зазначеної вище формулою.

В термінах **комплексних чисел** перетворення інверсії виражається достатньо просто, якщо вважати, що центр $O$ кола збігається з початком координат:

$$
z^\prime = r^2 \cdot \frac{ z }{ |z|^2 }.
$$

З допомогою сопряжённого елементу $\overline{z}$ можна получити більш просту форму:

$$
z^\prime = \frac{ r^2 }{ \overline{z} }.
$$

Застосування інверсії (в точці-середине дошки) до изображению шаховій дошки дає цікаву картинку (справа):

\img{inversion_9.png}

## Властивості

Очевидно, що будь-яка точка, лежащая **на кола**, щодо якій виготовляється перетворення інверсії, при отображении переходити в собі ж. Будь-Яка точка, лежащая **всередині** кола, переходити у **зовнішню** область, і навпаки. Вважається, що центр кола переходити в точку "нескінченність" $\infty$, а точка "нескінченність" - навпаки, в центр кола:

$$
(O)^\prime = \infty,
$$

$$
(\infty)^\prime = O.
$$

Очевидно, що повторное застосування перетворення інверсії **обращает** перший її застосування - всі точки возвращаются назад:

$$
\left( P^\prime \right) ^\prime \equiv P.
$$

### Обобщённые кола

Обобщённая коло - це або коло, або пряма (вважається, що це теж коло, але має нескінченний радіус).

Ключевое властивість перетворення інверсії - що при його застосуванні узагальнена коло **завжди переходити в обобщённую коло** (мається на увазі, що перетворення інверсії поточечно застосовується до всім точкам фігури).

Сейчас ми побачимо, що саме відбувається з прямими і колами при перетворенні інверсії.

### Інверсія прямої, що проходити через точку $O$

Стверджується, що будь-яка пряма, що проходить через $O$, після перетворення інверсії **не змінюється**.

Насправді, будь-яка точка цій прямої, крім $O$ і $\infty$, переходити по визначенню теж в точку цій прямої (причому в підсумку получившиеся точки заполнят всю пряму цілком, оскільки перетворення інверсії обратимо). Остаются точки $O$ і $\infty$, але при інверсії вони переходят один в одного, тому доведення завершено.

### Інверсія прямої, не що проходити через точку $O$

Стверджується, що будь-яка така пряма перейде **в коло**, що проходить через $O$.

\img{inversion_4.png}

Розглянемо будь-яку точку $P$ цій прямої, і розглянемо також точку $Q$ - найближчу до $O$ точку прямої. Зрозуміло, що відрізок $OQ$ перпендикулярен прямої, а тому образуемый їм кут $\angle PQO$ - прямої.

Скористаємося тепер **леммой про рівних кутах**, яку ми доведемо трохи пізніше, ця лема дає нам рівність:

$$
\angle PQO = \angle Q^\prime P^\prime O.
$$

Отже, кут $\angle Q^\prime P^\prime O$ теж прямої. Оскільки ми брали точку $P$ будь-який, то виходить, що точка $P^\prime$ лежить на кола, побудованої на $O Q^\prime$ як на диаметре. Легко зрозуміти, що в підсумку всі точки прямої покроют всю цю коло цілком, отже, твердження доведено.

### Інверсія кола, що проходити через точку $O$

Будь-Яка така коло перейде **в пряму**, не що проходить через точку $O$.

Насправді, це зразу випливає з попереднього пункту, якщо ми згадаємо про обратимости перетворення інверсії.

### Інверсія кола, не що проходити через точку $O$

Будь-Яка така коло перейде **в коло**, як і раніше не що проходить через точку $O$.

\img{inversion_5.png}

Насправді, розглянемо будь-яку таку коло $Z$ з центром в точці $O_2$. Соединим центри $O$ і $O_2$ кіл прямої; ця пряма пересечёт коло $Z$ в двох точках $S$ і $T$ (очевидно, $ST$ - діаметр $Z$).

Тепер розглянемо будь-яку точку $P$, лежающую на кола $Z$. Угол $\angle SPT$ прямої для будь-який такий точки, але по следствию з **леми про рівних кутах** також прямим повинен бути і кут $\angle S^\prime P^\prime T^\prime$, звідки і випливає, що точка $P^\prime$ лежить на кола, побудованої на відрізку $S^\prime T^\prime$ як на диаметре. Знову ж, легко зрозуміти, що всі образы $P^\prime$ в підсумку покроют цю коло.

Зрозуміло, що ця нова коло не можливо проходити через $O$: інакше б точка $\infty$ повинна була б належати старої кола.

### Лема про рівних кутах

Це допоміжне властивість, яке було использовано вище при анализе результатів перетворення інверсії.

#### Формулювання

Розглянемо будь-які дві точки $P$ і $Q$, і застосуємо до ним перетворення інверсії, отримаємо точки $P^\prime$ і $Q^\prime$. Значить наступні кути рівні:

$$
\angle PQO = \angle Q^\prime P^\prime O,
$$

$$
\angle QPO = \angle P^\prime Q^\prime O.
$$

#### Доведення

Доведемо, що трикутники $\triangle PQO$ і $\triangle Q^\prime P^\prime O$ подібні (порядок вершин важен!).

\img{inversion_1.png}

Насправді, по визначенню перетворення інверсії маємо:

$$
OP \cdot OP^\prime = r^2,
$$

$$
OQ \cdot OQ^\prime = r^2,
$$

звідки отримуємо рівність:

$$
OP \cdot OP^\prime = OQ \cdot OQ^\prime,
$$

$$
\frac{ OP }{ OQ } = \frac{ OQ^\prime }{ OP^\prime }.
$$

Таким чином, трикутники $\triangle PQO$ і $\triangle Q^\prime P^\prime O$ мають загальний кут, а дві прилежащие до нього сторони пропорційні, отже, ці трикутники подібні, а тому відповідні кути збігаються.

#### Слідство з леми

Якщо дані будь-які три точки $P$, $Q$, $R$, причому точка $R$ лежить на відрізку $OQ$, то виконується:

$$
\angle QPR = \angle Q^\prime P^\prime R^\prime,
$$

причому ці кути ориентированы в різні сторони (тобто якщо розглядати ці два кута як орієнтовані, то вони разного знака).

\img{inversion_2.png}

Для доведення зауважимо, що $\angle QPR$ - це різницю двох кутів $\angle QPO$ і $\angle RPO$, до кожному з яких можна застосувати лему про рівних кутах:

$$
\angle QPR = \angle QPO - \angle RPO = \angle P^\prime Q^\prime O - \angle P^\prime R^\prime O = \angle R^\prime P^\prime Q^\prime = \angle Q^\prime P^\prime R^\prime.
$$

При осуществлении останнього переходу ми изменили порядок слідування точок, що і означає, що ми изменили ориентацию кута на протилежну.

### Конформность

Перетворення інверсії є конформным, тобто **зберігає кути в точках перетину кривих**. При цим, якщо кути розглядати як орієнтовані, то ориентация кутів при застосуванні інверсії змінюється на протилежну.

\img{inversion_6.png}

Для **доведення** цього розглянемо дві довільні кривые, пересічні в точці $P$ і мають в ній дотичні. Нехай по першо] кривой буде йти точка $Q$, по другий - точка $R$ (ми їх устремим в пределе до $P$).

Очевидно, що після застосування інверсії кривые будуть як і раніше перетинатися (якщо, звісно, вони не проходили через точку $O$, але такий випадок ми не розглядаємо), і точкою їх перетину буде $P^\prime$.

Враховуючи, що точка $R$ лежить на прямої, соединяющей $O$ і $Q$, отримуємо, що можемо застосувати наслідок з леми про рівних кутах, з якій ми отримуємо:

$$
\angle QPR = - \angle Q^\prime P^\prime R^\prime,
$$

де під знаком "мінус" ми понимаем то, що кути ориентированы в різних напрямках.

Устремляя точки $Q$ і $R$ до точці $P$, ми в пределе отримуємо, що це рівність - вираз кута між пересічними кривыми, що і потрібно довести.

### Свойство отражения

Якщо $M$ - узагальнена коло, то при перетворенні інверсії вона **зберігається** тоді і тільки тоді, коли $M$ **ортогональна** кола $C$, щодо якій виготовляється інверсія ($M$ і $C$ вважаються різними).

Доведення цього властивості цікаво тим, що воно **демонстрирует** застосування геометричній інверсії для ухода від кіл і спрощення задачі.

Першим шагом **доведення** буде указание того факту, що $M$ і $C$ мають як мінімум дві точки перетину. Насправді, перетворення інверсії щодо $C$ отображает внутренность кола в її внешность, і навпаки. Раз $M$ після перетворення не изменилась, то значить, вона містить точки як з внутренности, так і з внешности кола $C$. Звідси і випливає, що точок перетину дві (одна вона бути не можливо - це означає касание двох кіл, але цього випадку, очевидно, бути по умові не можливо; збігатися кола також не можуть по визначенню).

Позначимо одну точку перетину через $A$, іншу - через $B$. Розглянемо довільну коло з центром в точці $A$, і виконаємо перетворення інверсії щодо її. Зауважимо, що тоді і коло $C$, і узагальнена коло $M$ необхідно переходят в пересічні прямі. Враховуючи конформность перетворення інверсії, отримуємо, що $M$ і $M^\prime$ збігалися тоді і тільки тоді, коли кут між двома цими пересічними прямими прямої (насправді, перший перетворення інверсії, - щодо $C$, - изменяет напрямок кута між колами на протилежне, тому якщо коло збігається зі своєї инверсией, то кути між пересічними прямими з обох сторін повинні збігатися, і рівні $\frac{ 180 }{ 2 } = 90$ градусов).

## Практическое застосування

Відразу варто відзначити, що при застосуванні в расчётах потрібно враховувати велику **похибка**, вносимую перетворенням інверсії: можуть з'являтися дробные числа вельми малых порядков, і зазвичай з-за високою похибки метод інверсії добре працює тільки зі порівняно небольшими координатами.

### Побудова фігур після інверсії

В программных вычислениях найчастіше більш зручно і надёжно використовувати не готовые формули для координат і радиусов получающихся обобщённых кіл, а відновлювати кожний раз прямі/кола по двома точкам. Якщо для відновлення прямої достатньо взяти будь-які дві точки і обчислити їх образы і з'єднати прямої, то з колами усе набагато складніше.

Якщо ми хочемо знайти коло, получившуюся в результаті інверсії прямої, то, згідно приведённым вище выкладкам, треба знайти найближчу до центру інверсії точку $Q$ прямої, застосувати до ній инверсию (отримавши якусь точку $Q^\prime$), і тоді шукана коло буде мати діаметр $O Q^\prime$.

Нехай тепер ми хочемо знайти коло, получившуюся в результаті інверсії іншої кола. Взагалі кажучи, центр нової кола - не збігається з чином центру старої кола. Для визначення центру нової кола можна скористатися таким прийомом: провести через центр інверсії і центр старої кола пряму, подивитися її точки перетину зі старої окружностью, - нехай це будуть точки $S$ і $T$. Отрезок $ST$ утворює діаметр старої кола, і легко зрозуміти, що після інверсії цей відрізок як і раніше буде образовывать діаметр. Отже, центр нової кола можна знайти як середнє арифметичне точок $S^\prime$ і $T^\prime$.

### Параметры кола після інверсії

Потрібно по заданої кола (по відомим координатам її центру $(x_0,y_0)$ і радиусу $r_0$) визначити, в яку саме коло вона перейде після перетворення інверсії щодо кола з центром в $(x_c,y_c)$ і радіусом $r$.

тобто. ми вирішуємо задачу, описану в попередньому пункті, але хочемо получити розв'язок в аналитическом вигляді.

Відповідь виглядає в вигляді формул:

$$
x^\prime = x_c + s (x_0 - x_c),
$$

$$
y^\prime = y_c + s (y_0 - y_c),
$$

$$
r^\prime = |s| \cdot r_0,
$$

де

$$
s = \frac{ r^2 }{ (x_0 - x_c)^2 + (y_0 - y_c)^2 - r_0^2 }.
$$

Мнемонически ці формули можна запам'ятати так: центр кола переходити "майже" як по преобразованию інверсії, тільки в знаменателе крім $|z|^2 = (x_0 - x_c)^2 + (y_0 - y_c)^2$ з'явилося ще вычитаемое $r_0^2$.

Выводятся ці формули рівне по описаного в попередньому пункті алгоритму: знаходяться вираження для двох диаметральных точок $S$ і $T$, потім до ним застосовується інверсія, і потім береться середнє арифметичне від їх координат. Аналогічно можна порахувати і радіус як половину довжини відрузку $ST$.

### Застосування в доказательствах: задача про разбиении точок окружностью

Дано $2n$ різних точок на площині, а також довільна точка $O$, отличная від всіх інших. Довести, що знайдеться коло, що проходить через точку $O$, така, що всередині і поза її буде лежати однакове число точок набору, тобто по $n$ штук.

Для **доведення** зробимо перетворення інверсії щодо обраної точки $O$ (з любым радіусом, наприклад, $r=1$). Значить шуканої кола буде відповідати пряма, не що проходить через точку $O$. Причому по одну сторону прямої лежить полуплоскость, відповідна внутренности кола, а по іншу - відповідна внешности. Зрозуміло, що завжди знайдеться така пряма, яка розбиває множину з $2n$ точок на дві половини по $n$ точок, і при цим не проходити через точку $O$ (наприклад, таку пряму можна получити, повернув всю картину на будь-який такий кут, аби ні у яких з розглянутих $2n+1$ точок не збіглися координати $x$, а потім просто взявши вертикальну пряму між $n$-ой і $n+1$-ої точками). Ця пряма відповідає шуканої кола, що проходити через точку $O$, а значить, твердження доведено.

### Застосування при рішенні задач обчислювальної геометрії

Замечательное властивість геометричній інверсії - в тому, що у багатьох випадках вона дозваляє спростити поставленную геометрическую задачу, заменяя розгляд кіл тільки рассмотрением прямих.

тобто. якщо задача має достатньо складний вид різних операцій з колами, то має сенс застосувати до входным даними перетворення інверсії, спробувати розв'язати отриману модифіковану задачу без кіл (або з меншим їх числом), і потім повторным застосуванням інверсії получити розв'язок вихідної задачі.

Приклад такий задачі описаний в наступному розділі.

### Цепочки Штейнера

Дано дві кола $C$ і $D$, одна знаходиться строго всередині іншої. Потім малюється третья коло $E$, касающаяся цих двох кіл, після чого запускується итеративный процес: кожний раз малюється нова коло так, аби вона **касалась** попередньою нарисованной, і перших двох. Рано або пізно чергова нарисованная коло пересечётся з якийсь з вже поставлених, або по крайньої міру коснётся її.

Випадок перетину:

\img{inversion_8.png}

Випадок касания:

\img{inversion_7.png}

Відповідно, наша задача - поставити **як можна більше** кіл так, аби перетину (тобто першого з представленных випадків) не було. Перші дві кола (зовнішня і внутрішня) фиксированы, ми можемо лише варіювати становище першо] що стосується кола, далі всі касающиеся кола ставятся однозначно.

В випадку касания получающая ланцюжок кіл називається **ланцюжком Штейнера**.

З цій ланцюжком пов'язане так зване **твердження Штейнера** (Steiner's porism): якщо існує хоча б одна ланцюжок Штейнера (тобто існує відповідне становище стартової що стосується кола, приводящее до цепочке Штейнера), то при будь-якому другом виборі стартової що стосується кола також буде виходити ланцюжок Штейнера, причому число кіл в ній буде таким ж.

З цього затвердження випливає, що і при рішенні задачі максимизации числа кіл відповідь не залежить від позиції першо] поставленной кола.

**Доведення** і конструктивный алгоритм розв'язку наступні. Зауважимо, що задача має дуже просте розв'язок в випадку, коли центри зовнішньої і внутрішньої кіл збігаються. Зрозуміло, що в цим випадку число поставлених кіл ніяк не буде залежати від першо] поставленной. В цим випадку всі кола мають одинаковый радіус, і число їх і координати центрів можна порахувати по простим формулами.

Щоб перейти до цій простий ситуації з будь-який подаваемой на вхід, застосуємо перетворення інверсії щодо деякої кола. Нам потрібно, аби центр внутрішньої кола передвинулся і совпал з центром зовнішньої, тому шукати точку, щодо якій будемо брати инверсию, треба тільки на прямої, соединяющей центри кіл. Використовуючи формули для координат центру кола після застосування інверсії, можна скласти рівняння на становище центру інверсії, і розв'язати це рівняння. Тим самим ми від довільної ситуації можемо перейти до простому, симметрическому нагоди, а, вирішивши задачу для нього, повторно застосуємо перетворення інверсії і отримаємо розв'язок вихідної задачі.

### Застосування в техніці: прямило Липкина-Поселье

Долгое час задача перетворення кругового (вращательного) руху в прямолинейное оставалась вельми складної в машиностроении, удавалось знаходити в лучшем випадку приближённые розв'язку. І лише в 1864 р. офицер инженерного корпуса французской армии Шарль Никола Поселье (Charles-Nicolas Peaucellier) і в 1868 р. студент Чебышёва Липман Липкин (Lipman Lipkin) изобрели це устройство, основанное на ідеї геометричній інверсії. Устройство получило назва **"прямило Липкина-Поселье"** (Peaucellier–Lipkin linkage).

\img{inversion_10.gif}

Щоб зрозуміти роботу устройства, відзначимо на ньому декілька точок:

\img{inversion_11.png}

Крапка $B$ здійснює вращательное рух по кола (красного кольори), в результаті чого точка $D$ необхідно рухається по прямої (синего кольори). Наша задача - довести, що точка $D$ - суть інверсія точки $B$ щодо центру $O$ з деяким радіусом $r$.

Формализуем умова задачі: що точка $O$ жёстко закреплена, відрізки $OA$ і $OC$ збігаються, і також збігається четвёрка відрізків $AB$, $BC$, $CD$, $DA$. Крапка $B$ рухається уздовж кола, що проходити через точку $O$.

Для **доведення** зауважимо на початку, що точки $O$, $B$ і $D$ лежати на однієї прямої (це випливає з рівності трикутників). Позначимо через $P$ точку перетину відрізків $AC$ і $BD$. Введемо позначення:

$$
OB=x,~~~BP=y,~~~AP=h.
$$

Нам потрібно показати, що величина $OB \cdot OD = {\rm const}$:

$$
OB \cdot OD = x(x+2y) = x^2 + 2xy.
$$

За теоремі Пифагора отримуємо:

$$
OA^2 = (x+y)^2 + h^2,
$$

$$
AD^2 = y^2 + h^2.
$$

Візьмемо різницю цих двох величин:

$$
OA^2 - AD^2 = x^2 + 2xy = OB \cdot OD.
$$

Таким чином, ми довели, що $OB \cdot OD = {\rm const}$, що і означає, що $D$ - інверсія точки $B$.
