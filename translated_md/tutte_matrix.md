# Матриця Татта

Матриця Татта - це изящный підхід до розв'язку задачі про **паросполуці** в довільному (не обов'язково дводольному) графі. Правда, в простому вигляді алгоритм не выдаёт самі ребра, що входять в паросполука, а тільки розмір максимального паросполука в графі.

Нижче ми спочатку розглянемо результат, отриманий Таттом (Tutte) для перевірки існування вчиненого паросполука (тобто паросполука, содержащего $n/2$ ребер, і тому насыщающего всі $n$ вершин). Після цього ми розглянемо результат, отриманий пізніше Ловасом (Lovasz), який вже дозваляє шукати розмір максимального паросполука, а не тільки ограничивается випадком вчиненого паросполука. Потім наводиться результат Рабина (Rabin) і Вазирани (Vazirani), які указали алгоритм відновлення самого паросполука (як набору що входять в нього ребер).

## Визначення

Нехай дано граф $G$ з $n$ вершинами ($n$ - парне).

Значить **матрицею Татта** (Tutte) називається наступна матриця $n \times n$:

$$
\begin{pmatrix}
0 & x_{12} & x_{13} & \ldots & x_{1(n-1)} & x_{1n} \cr
-x_{12} & 0 & x_{23} & \ldots & x_{2(n-1)} & x_{2n} \cr
-x_{13} & -x_{23} & 0 & \ldots & x_{3(n-1)} & x_{3n} \cr
\vdots & \vdots & \vdots & \ddots & \vdots & \vdots \cr
-x_{1(n-1)} & -x_{2(n-1)} & -x_{3(n-1)} & \ldots & 0 & x_{(n-1)n} \cr
-x_{1n} & -x_{2n} & -x_{3n} & \ldots & -x_{(n-1)n} & 0 \cr
\end{pmatrix}
$$

де $x_{ij}$ ($1 \le i < j \le n$) - це або незалежна змінна, відповідна ребру між вершинами $i$ і $j$, або тождественный нуль, якщо ребра між цими вершинами ні.

Таким чином, в випадку повного графа з $n$ вершинами матриця Татта містить $n (n-1) / 2$ незалежних змінних, якщо ж в графі які-то ребра відсутні, то відповідні елементи матриці Татта превращаются в нулі. Взагалі, число змінних в матриці Татта збігається з числом ребер графа.

Матриця Татта антисимметрична (кососимметрична).

## Теорема Татта

Розглянемо визначник $\det(A)$ матриці Татта. Це, взагалі кажучи, багаточлен щодо змінних $x_{ij}$.

**Теорема Татта** свідчить: в графі $G$ існує вчинене паросполука тоді і тільки тоді, коли багаточлен $\det(A)$ не рівний нулю тождественно (тобто має хоча б одне доданок з ненульовим коефіцієнтом). Нагадаємо, що паросполука називається совершенным, якщо воно насичує всі вершини, тобто його потужність рівна $n/2$.

Канадский математик Вильям Томас Татт (William Thomas Tutte) першим указал на тесную зв'язок між паросочетаниями в графах і определителями матриць (1947 г).. Більш простий вид цій зв'язку пізніше обнаружил Эдмондс (Edmonds) в випадку дводольних графів (1967 г).. Рандомизированные алгоритми для знаходження величини максимального паросполука і самих ребер цього паросполука були предложены пізніше, відповідно, Ловасом (Lovasz) (в 1979 г)., і Рабином (Rabin) і Вазирани (Vazirani) (в 1984 г)..

### Практическое застосування: рандомизированный алгоритм

Безпосередньо застосовувати теорему Татта навіть в задачі перевірки існування вчиненого паросполука недоцільно. Причиной цього є то, що при символьном обчисленні визначника (тобто в вигляді багаточленів над переменными $x_{ij}$) проміжні результати є многочленами, содержащими $O(n^2)$ змінних. Тому обчислення визначника матриці Татта в символьном вигляді зажадає невиправдано багато часу.

Угорський математик Ласло Ловас (Laszlo Lovasz) був першим, указавшим можливість застосування тут **рандомизированного** алгоритму для спрощення обчислень.

Ідея дуже проста: замінимо всі змінні $x_{ij}$ случайными числами:

$$
x_{ij} = {\rm rand}().
$$

Значить, якщо полином $\det(A)$ був тождественно нульовим, після такий замены він і буде оставаться нульовим; якщо ж він був отличным від нуля, то при такий случайной числовий замене ймовірність того, що він обратится в нуль, достатньо мала.

Зрозуміло, що такий тест (подстановка випадкових значень і обчислення визначника $\det(A)$) якщо і ошибается, то тільки в одну сторону: можливо сообщить про отсутствии вчиненого паросполука, коли насправді воно існує.

Ми можемо повторити цей тест декілька раз, підставляючи в якості значень змінних нові випадкові числа, і з кожним повторным запуском ми отримуємо усе велику уверенность в тому, що тест выдал правильный відповідь. На практиці в більшості випадків достатньо одного тесту, аби визначити, є або в графі вчинене паросполука або ні; декілька таких тестів дають вже вельми высокую ймовірність.

Для оцінки **вероятности помилки** можна використовувати лему Шварца-Зиппеля (Schwartz–Zippel), яка свідчить, що ймовірність обращения в нуль ненульового полінома $P$ $k$-ой степені при подстановке в якості значень змінних випадкових чисел, кожне з яких можливо приймати $s$ варіантів значення, - ця ймовірність задовольняє нерівності:

$$
{\rm Pr}[P(r_1,\ldots,r_k)=0] \le \frac{k}{s}.
$$

Наприклад, при використанні стандартної функції випадкових чисел C++ $\rm rand()$ отримуємо, що ця ймовірність при $n=300$ становить близько процента.

**Асимптотика** розв'язку виходить рівній $O(n^3)$ (з використанням, наприклад, [алгоритму Гауса](determinant_gauss)), помножене на кількість ітерацій тесту. Варто відзначити, що по асимптотиці таке розв'язок значно отстаёт від розв'язку [алгоритмом Едмондса стиснення квіток](matching_edmonds), однак в деяких випадках більш предпочтительно з-за простоти реалізації.

**Восстановить** саме вчинене паросполука як набір ребер є більш складної завданням. Самым простим, хоча і медленным, варіантом буде відновлення цього паросполука по одному ребру: перебираємо перший ребро відповіді, вибираємо його так, аби в залишився графі існувало вчинене паросполука, і т.д.

### Доведення теореми Татта

Щоб добре зрозуміти доведення цій теореми, спочатку розглянемо більш простий результат, - отриманий Эдмондсом для випадку дводольних графів.

#### Теорема Едмондса

Розглянемо дводольний граф, в кожної частці якого по $n$ вершин. Составим матрицю $B$ $n \times n$, в якій, по аналогії з матрицею Татта, $b_{ij}$ є окремої независимой змінній, якщо ребро $(i,j)$ присутній в графі, і є тождественным нулем в іншому випадку.

Ця матриця схожа на матрицю Татта, однак матриця Едмондса має вдвічі меншу різницю, і кожному ребру тут відповідає тільки одна комірка матриці.

Доведемо наступну **теорему**: визначник $\det(B)$ відмінний від нуля тоді і тільки тоді, коли в дводольному графі існує вчинене паросполука.

**Доведення**. Распишем визначник згідно його визначенню, як сума по всім перестановкам:

$$
\det(B) = \sum_{\pi \in S_n} {\rm sgn}(\pi) \cdot b_{1,\pi_1} \cdot b_{2,\pi_2} \cdot \ldots \cdot b_{n,\pi_n}.
$$

Зауважимо, що оскільки всі ненулевые елементи матриці $B$ - різні незалежні змінні, то в цій сумі всі ненулевые слагаемые різні, а тому ніяких сокращений в процесі підсумовування не відбувається. Залишилося замітити, що будь-яке ненульове доданок в цій сумі означає непересекающийся по вершин набір ребер, тобто деякий вчинене паросполука. І навпаки, будь-якого совершенному паросполуці відповідає ненульове доданок в цій сумі. Вкупе з вышесказанным це доводить теорему.

#### Властивості антисиметричних матриць

Для доведення теореми Татта необхідно скористатися несколькими известными фактами лінійної алгебри про свойствах антисиметричних матриць.

**По-перше**, якщо антисиметрична матриця має нечётный розмір, то її визначник завжди рівний нулю (теорема Якобі (Jacobi)). Для цього достатньо замітити, що антисиметрична матриця задовольняє равенству $A^T = -A$, і тепер отримуємо ланцюжок равенств:

$$
\det(A) = \det(A^T) = \det(-A) = (-1)^n \det(A),
$$

звідки і випливає, що при непарних $n$ визначник необхідно повинен бути рівний нулю.

**По-друге**, виявляється, що в випадку антисиметричних матриць парного розміру їх визначник завжди можна записати як квадрат деякого полінома щодо змінних-елементів цій матриці (полином називається пфаффианом (pfaffian), а результат належить Мьюру (Muir)):

$$
\det(A) = {\rm Pf}^2(A).
$$

**По-третє**, цей пфаффиан представляє собою не довільний багаточлен, а суму увазі:

$$
{\rm Pf}(A) = \frac{ 1 }{ 2^n n! } \sum_{\pi \in S_n} {\rm sgn(\pi)} \cdot a_{\pi_1,\pi_2} \cdot a_{\pi_3,\pi_4} \cdot \ldots \cdot a_{\pi_{n-1},\pi_n}.
$$

Таким чином, кожне доданок в пфаффиане - це добуток таких $n/2$ елементів матриці, що їх індекси в сукупності являють собою розбиття множини $n$ на $n/2$ пар. Перед кожним слагаемым є свій коефіцієнт, але його вид нас тут не цікавить.

#### Доведення теореми Татта

Скориставшись іншим і третьим властивістю з попереднього пункту, ми отримуємо, що визначник $\det(A)$ матриці Татта представляє собою квадрат від суми доданків такого увазі, що кожне доданок - добуток елементів матриці, індекси яких не повторяются і покрывают всі номера від $1$ до $n$. Таким чином, знову, як і в доведенні теореми Едмондса, кожне ненульове доданок цій суми відповідає совершенному паросполуці в графі, і навпаки.

## Теорема Ловаса: узагальнення для пошуку розміру максимального паросполука

### Формулювання

**Ранг** матриці Татта збігається з подвоєною величиною **максимального паросполука** в даному графі.

### Застосування

Для застосування цій теореми на практиці можна скористатися тим ж самим прийомом рандомизации, що і в вищеописаному алгоритмі для матриці Татта, а саме: підставити замість змінних випадкові значення, і знайти ранг отриманої числовий матриці. Ранг матриці, знову ж, шукається за $O(n^3)$ з допомогою модифікованого алгоритму Гауса, див. [тут](matrix_rank).

Втім, випливає відзначити, що наведена вище лема Шварца-Зиппеля неприменима в явному вигляді, і інтуїтивно здається, що ймовірність помилки тут стає вище. Однак затверджується (див. роботи Ловаса (Lovasz)), що і тут ймовірність помилки (тобто того, що ранг отриманої матриці виявиться менше, ніж удвоенный розмір максимального паросполука) не перевершує $\frac{n}{s}$ (де $s$, як і вище, позначає розмір множини, з якого выбираются випадкові числа).

### Доведення

Доведення буде вытекать з теореми лінійної алгебри, відомої як **теорема Фробениуса** (Frobenius). Нехай дана антисиметрична матриця $A$ розміру $n \times n$, і нехай множини $S$ і $T$ - будь-які два підмножини множини $\{ 1, \ldots, n \}$, причому розміри цих множин збігаються і рівні рангу матриці $A$. Позначимо через $A_{XY}$ матрицю, отриману з матриці $A$ тільки рядками з номерами з множини $X$ і столбцами з номерами з множини $Y$ (де $X$ і $Y$ - деякі підмножини множини $\{ 1, \ldots, n \}$). Значить виконується:

$$
\det(A_{SS}) \cdot \det(A_{TT}) = \det(A_{ST}) \cdot \det(A_{TS}).
$$

Покажемо, як це властивість дозваляє установить **відповідність** між рангом матриці $A$ Татта і величиною максимального паросполука.

З однієї сторони, розглянемо в графі $G$ деякий максимальне паросполука, і позначимо множину насыщаемых їм вершин через $U$. Значить, згідно теоремі Татта, визначник $\det(A_{UU})$ відмінний від нуля. Следователь, ранг матриці Татта - як мінімум $2|U|$, тобто не менше подвоєною величини максимального паросполука.

Покажемо тепер зворотнє нерівність. Позначимо ранг матриці $A$ через $r$. Це означає, що нашлась така подматріца $A_{ST}$, де $|S| = |T| = r$, визначник якій відмінний від нуля. Легко замітити, що $A_{TS}$ також буде відмінно від нуля. Але по наведеної вище теоремі Фробениуса це означає, що обидві матриці $A_{SS}$ і $A_{TT}$ мають ненульовий визначник. Звідси випливає, що $r$ парне (тому що, як було отмечено вище, антисиметрична матриця непарної розмірності завжди має нульовий визначник). Таким чином, ми можемо застосувати до подматрице $A_{SS}$ (або $A_{TT}$) теорему Татта. Отже, в подграфе, индуцированном безліччю вершин $S$ (або безліччю вершин $T$), є вчинене паросполука (і величина його рівна $r/2$). Таким чином, ранг матриці Татта не можливо бути більше подвоєною величини максимального паросполука.

Об'єднуючи два доказанных нерівності, ми отримуємо твердження теореми: ранг матриці Татта збігається з подвоєною величиною максимального паросполука.

## Алгоритм Рабина-Вазирани знаходження максимального паросполука

Цей алгоритм є дальнейшим обобщением двох попередніх теорем, і дозваляє, в відміну від них, выдавать не тільки величину максимального паросполука, але і самі ребра, що входять в нього.

### Формулювання теореми

Нехай в графі існує вчинене паросполука. Значить його матриця Татта невырождена, тобто $\det(A) \ne 0$. Сгенерируем по ній, як було описано вище, випадкову числовую матрицю $B$. Значить, з високою ймовірністю, $(B^{-1})_{ji} \ne 0$ тоді і тільки тоді, коли ребро $(i,j)$ входити в яке-або вчинене паросполука.

(Тут через $B^{-1}$ позначена матриця, зворотна до $B$. Передбачається, що визначник матриці $B$ відмінний від нуля, тому зворотна матриця існує).

### Застосування

Цю теорему можна застосовувати для відновлення самих ребер максимального паросполука. Спочатку доведеться виділити підграф, в якому міститься шукане максимальне паросполука (це можна зробити паралельно з алгоритмом пошуку рангу матриці).

Після цього задача зводиться до пошуку вчиненого паросполука по даній числовий матриці, отриманої з матриці Татта. Тут ми вже застосовуємо теорему Рабина-Вазирани, - знаходимо зворотню матрицю (що можна зробити модифицированным алгоритмом Гауса за $O(n^3)$), знаходимо в ній будь-який ненульовий елемент, видаляємо з графа, і повторюємо процес. Асимптотика такого розв'язку буде не самою швидкої - $O(n^4)$, зате натомість отримуємо простоту розв'язку (по порівняно, наприклад, з [алгоритмом Едмондса стиснення квіток](matching_edmonds)).

### Доведення теореми

Згадаймо известную формулу для елементів зворотного матриці $B^{-1}$:

$$
(B^{-1})_{ji} = \frac{ {\rm adj}(B)_{i,j} }{ \det(B) },
$$

де через ${\rm adj}(B)_{i,j}$ обозначено алгебраическое дополнение, тобто це число $(-1)^{i+j}$, помножене на визначник матриці, получаемой з $B$ удалением $i$-й стрічки і $j$-го стовпчика.

Звідси зразу отримуємо, що елемент $(B^{-1})_{ji}$ відмінний від нуля тоді і тільки тоді, коли матриця $B$ з вычеркнутыми $i$-ой рядком і $j$-им столбцом має ненульовий визначник, що, застосовуючи теорему Татта, означає з високою ймовірністю, що в графі без вершин $i$ і $j$ як і раніше існує вчинене паросполука.

## Література

* \book{William Thomas Tutte}{The Factorization of Linear Graphs}{1946}{tutte.pdf}
* \book{Laszlo Lovasz}{On Determinants, Matchings and Random Algorithms}{1979}
* \book{Laszlo Lovasz, M.D. Plummer}{Matching Theory}{1986}{lovasz_plummer.pdf}
* \book{Michael Oser Rabin, Vijay V. Vazirani}{Maximum matchings in general graphs through randomization}{1989}
* \book{Allen B. Tucker}{Computer Science Handbook}{2004}{tucker.pdf}
* \book{Rajeev Motwani, Prabhakar Raghavan}{Randomized Algorithms}{1995}{motwani.djvu}
* \book{A.C. Aitken}{Determinants and matrices}{1944}{aitken.pdf}
