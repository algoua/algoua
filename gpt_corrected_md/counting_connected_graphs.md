<h2>Кількість позначених графів</h2>

Дано число $N$ вершин. Потрібно порахувати кількість $G_N$ різних позначених графів з $N$ вершинами (тобто вершини графа позначені різними числами від $1$ до $N$, і графи порівнюються з урахуванням цього фарбування вершин). Ребра графа неорієнтовані, петлі та кратні ребра заборонені.

Розглянемо множину всіх можливих ребер графа. Для будь-якого ребра $(i,j)$ припустимо, що $i<j$ (враховуючи неорієнтованість графа та відсутність петель). Отже, множина всіх можливих ребер графа має потужність $C_N^2$, тобто $\frac{N(N-1)}{2}$.

Оскільки будь-який позначений граф однозначно визначається своїми ребрами, то кількість позначених графів з $N$ вершинами дорівнює:

$$
G_N = 2^{ \frac{ N (N-1) }{ 2 } }
$$

## Кількість зв'язаних позначених графів

З порівняно з попереднім завданням ми додатково накладаємо обмеження, що граф повинен бути зв'язним.

Позначимо шукане число як $Конн_N$.

Навчимося навпаки вважати кількість **несполучених** графів; тоді кількість сполучених графів вийде як $G_N$ мінус знайдене число. Більше того, навчимося вважати кількість **кореневих** (тобто з виділеною вершиною - коренем) **несполучених графів**; тоді кількість несполучених графів буде виходити з нього діленням на $N$. Зауважимо, що, так як граф несполучений, то в ньому знайдеться компонента зв'язності, всередині якої лежить корінь, а решта графу буде представляти собою ще декілька (принаймні одну) компонент зв'язності.

Переберемо кількість $K$ вершин у цій компоненті зв'язності, яка містить корінь (очевидно, $K = 1 \ldots N-1$), і знайдемо кількість таких графів. По-перше, ми повинні вибрати $K$ вершин з $N$, тобто відповідь множиться на $C_N^K$. По-друге, компонента зв'язності з коренем дає множник $Conn_K$. По-третє, залишився граф з $N-K$ вершин, який є довільним графом, а тому він дає множник $G_{N-K}$. Нарешті, кількість способів виділити корінь в компоненті зв'язності з $K$ вершинами дорівнює $K$. Разом, при фіксованому $K$ кількість **кореневих зв'язних** графів рівна:

$$
K\ C_N^K\ Conn_K\ G_{N-K}
$$

Значить, кількість **непов'язних** графів з $N$ вершинами дорівнює:

$$
\frac{1}{N} \sum_{K=1}^{N-1} K\ C_N^K\ Conn_K\ G_{N-K}
$$

Нарешті, шукана кількість **зв'язних** графів дорівнює:

$$
Conn_N = G_N - \frac{1}{N} \sum_{K=1}^{N-1} K\ C_N^K\ Conn_K\ G_{N-K}
$$

## Кількість позначених графів з $K$ компонентами зв'язності

Основуючись на попередній формулі, навчимося визначати кількість позначених графів з $N$ вершинами і $K$ компонентами зв'язності.

Це можна зробити за допомогою динамічного програмування. Навчимося розраховувати **$D[N][K]$** - кількість позначених графів з $N$ вершинами і $K$ компонентами зв'язності.

Навчимося обчислювати наступний елемент $D[N][K]$, знаючи попередні значення. Скористаємося стандартним прийомом при розв'язанні таких задач: візьмемо вершину з номером 1, вона належить якійсь компоненті. Цю компоненту ми і будемо перебирати. Переберемо розмір $S$ цієї компоненти, тоді кількість способів вибрати таку множину вершин рівна $C_{N-1}^{S-1}$ (одну вершину - вершину 1 - перебирати не треба). Кількість способів побудувати компоненту зв'язності з $S$ вершинами ми вже вміємо вважати - це $Conn_S$. Після видалення цієї компоненти з графа залишається граф з $N-S$ вершинами і $K-1$ компонентами зв'язності. Отже, ми отримали рекурентну залежність, за якою можна обчислювати значення $D[][]$:

$$
D[N][K] = \sum_{S=1}^{N} C_{N-1}^{S-1}\ Conn_S\ D[N-S][K-1]
$$

Разом отримуємо приблизно такий код:
<!--- TODO: specify code snippet id -->
``` cpp
int d[n + 1][k + 1]; // спочатку заповнено нулями
d[0][0][0] = 1;
for (int i = 1; i <= n; ++i)
    for (int j = 1; j <= i && j <= k; ++j)
        for (int s = 1; s <= i; ++s)
            d[i][j] += C[i - 1][s - 1] * conn[s] * d[i - s][j - 1];
cout << d[n][k][n];
```

Зрозуміло, на практиці, ймовірно, буде потрібна довга арифметика.