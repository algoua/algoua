# Знаходження рівняння прямої для відрізку

Задача полягає у побудові прямої, яка проходить через координати кінця відрізка.

Ми припустимо, що відрізок невироджений, тобто має довжину більше нуля (інакше, зрозуміло, через нього проходить нескінченна кількість різних прямих).

## Двовимірний випадок

Нехай заданий відрізок $PQ$, тобто відомі координати його кінців $P_x$, $P_y$, $Q_x$, $Q_y$.

Потрібно побудувати **рівняння прямої на площині**, яка проходить через цей відрізок, тобто знайти коефіцієнти $k$, $b$ в рівнянні прямої:

$$
A x + B y + C = 0.
$$

Зауважимо, що шуканих трійок $(A,B,C)$, які проходять через заданий відрізок, **нескінченно багато**: можна помножити всі три коефіцієнти на довільне ненульове число і отримати ту саму пряму. Отже, наша задача полягає в тому, щоб знайти одну з таких трійок.

Не складно переконатися (підстановкою цих виразів і координат точок $P$ і $Q$ в рівняння прямої), що підходить наступний набір коефіцієнтів:

$$
A = P_y - Q_y,
$$

$$
B = Q_x - P_x,
$$

$$
C = - A P_x - B P_y.
$$

### Цілочисельний випадок

Важним перевагою такого способу побудови прямої є те, що якщо координати кінців були цілими числами, то і отримані коефіцієнти також будуть **цілими числами**. У деяких випадках це дозволяє виконувати геометричні операції, не вдаючись до дійсних чисел.

Однак є невеликий недолік: для однієї і тієї ж прямої можуть виходити різні трійки коефіцієнтів. Щоб уникнути цього, але не відходити від цілочисельних коефіцієнтів, можна застосувати наступний прийом, часто званий **нормуванням**. Знайдімо [найбільший спільний дільник](euclid_algorithm) чисел $|A|$, $|B|$, $|C|$, поділимо на нього всі три коефіцієнти, а потім зробимо нормування знака: якщо $A<0$ або $A=0$, $B<0$, то помножимо всі три коефіцієнти на $-1$. В результаті ми прийдемо до того, що для однакових прямих будуть виходити однакові трійки коефіцієнтів, що дозволить легко перевіряти прямі на рівність.

### Векторний випадок

При роботі з дійсними числами виникає необхідність завжди пам'ятати про похибки.

Коефіцієнти $A$ і $B$ залежать від вихідних координат, а коефіцієнт $C$ - від квадрату вихідних координат. Ці значення можуть бути дуже великими, особливо при [перетині прямих](lines_intersection), що може призвести до помилок округлення при вихідних координатах порядку $10^3$.

Тому під час роботи з дійсними числами бажано виконувати так зване **нормування** вектора: зробити коефіцієнти такими, щоб $A^2 + B^2 = 1$. Для цього потрібно обчислити число $Z$:

$$
Z = \sqrt{ A^2 + B^2 },
$$

і розділити всі три коефіцієнти $A$, $B$, $C$ на нього.

Тим самим, порядок коефіцієнтів $A$ і $B$ вже не буде залежати від порядку вхідних координат, а коефіцієнт $C$ матиме той самий порядок, що і вхідні координати. На практиці це призводить до значного покращення точності обчислень.

Нарешті, згадаємо про **порівняно прямі** - адже після такої нормалізації для однієї і тієї ж прямої можуть виходити тільки дві трійки коефіцієнтів: з точністю до множення на $-1$. Відповідно, якщо ми зробимо додаткову нормалізацію з урахуванням знака (якщо $A<-\varepsilon$ або $|A|<\varepsilon$, $B<-\varepsilon$, то помножимо на $-1$), то отримані коефіцієнти будуть унікальними.

## Трирівневий і багатовимірний випадок

Уже в тривимірному випадку **немає простого рівняння**, що описує пряму (її можна задати як перетин двох площин, тобто систему двох рівнянь, але це не зручний спосіб).

Отже, в тривимірному і багатовимірному випадках ми повинні користуватися **параметричним способом задання прямої**, тобто у вигляді точки $P$ і вектора $\vec{v}$:

$$
p + v t, ~~~ t \in \cal{R}.
$$

тобто, пряма - це всі точки, які можна отримати з точки $p$ додаванням вектора $v$ з довільним коефіцієнтом.

Побудова прямої в параметричному вигляді за координатами кінців відрізку - тривіальна, ми просто беремо один кінець відрізку за точку $p$, а вектор від першого до другого кінця - за вектор $v$.