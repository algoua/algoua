# Гра "П'ятнашки": існування розв'язку

Нагадаємо, що гра представляє собою поле $4\times4$, на якому розташовані $15$ плиток, пронумерованих числами від $1$ до $15$, а одне поле залишено порожнім. Потрібно пересуваючи на кожному кроці будь-яку плитку на вільну позицію, прийти в кінці до наступного стану:

$$
\matrix{
1&2&3&4\cr
5&6&7&8\cr
9&10&11&12\cr
13&14&15&\bigcirc\cr
}
$$

Гру "П'ятнашки" ("15 puzzle") винайшов у 1880 році Нойс Чепман (Noyes Chapman).

## Існування розв'язку

Тут ми розглянемо таку задачу: за допомогою даної позиції на дошці визначити, чи існує послідовність ходів, яка приведе до розв'язку.

Нехай задана певна позиція на дошці:

$$
\matrix{
a_1 & a_2 & a_3 & a_4 \cr 
a_5 & a_6 & a_7 & a_8 \cr 
a_9 & a_{10} & a_{11} & a_{12} \cr 
a_{13} & a_{14} & a_{15} & a_{16} \cr 
}
$$

де один з елементів дорівнює нулю і позначає порожню комірку $a_z = 0$.

Розглянемо перестановку:

$$
a_1 a_2 \ldots a_{z-1} a_{z+1} \ldots a_{15} a_{16}
$$

(тобто перестановка чисел, що відповідає позиції на дошці, без нульового елементу)

Позначимо через $N$ кількість інверсій у цій перестановці (тобто кількість таких елементів $a_i$ і $a_j$, що $i < j$, але $a_i > a_j$).

Далі нехай $K$ -- номер рядка, в якому знаходиться порожній елемент (тобто в наших позначеннях $K = (z-1)\ {\rm div}\ 4 + 1)$.

Значить, розв'язок існує лише тоді, коли $N+K$ є парним.

## Реалізація

Проілюструємо зазначений вище алгоритм за допомогою програмного коду:
<!--- TODO: specify code snippet id -->
``` cpp
int a[16];
for (int i = 0; i < 16; ++i)
    cin >> a[i];

int inv = 0;
for (int i = 0; i < 16; ++i)
    if (a[i])
        for (int j = 0; j < i; ++j)
            if (a[j] > a[i])
                ++inv;
for (int i = 0; i < 16; ++i)
    if (a[i] == 0)
        inv += 1 + i / 4;

puts((inv & 1) ? "No Solution" : "Solution Exists");
```

## Доведення

Джонсон у 1879 році довів, що якщо $N+K$ є непарним, то розв'язку не існує. У той же рік Сторі довів, що всі позиції, для яких $N+K$ є парним, мають розв'язок.

Однак обидва ці доведення були досить складні.

У 1999 році Арчер запропонував значно простіше доведення (завантажити його статтю можна [тут](http://www.cs.cmu.edu/afs/cs/academic/class/15859-f01/www/notes/15-puzzle.pdf)).