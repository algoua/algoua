# Матриця Татта

Матриця Татта - це елегантний підхід до розв'язання задачі про **незалежне множину** в довільному (не обов'язково двудольному) графі. Проте, в простій формі алгоритм не повертає самі ребра, які входять до незалежної множини, а лише розмір максимальної незалежної множини в графі.

Нижче ми спочатку розглянемо результат, отриманий Таттом (Тютте) для перевірки існування виконаної паросполучення (тобто паросполучення, що містить $n/2$ ребер і, отже, насичує всі $n$ вершин). Після цього ми розглянемо результат, отриманий пізніше Ловасом (Ловашем), який дозволяє шукати розмір максимального паросполучення, а не обмежується лише випадком виконаного паросполучення. Потім наводиться результат Рабіна (Рабіна) і Вазірані (Вазірані), які вказали алгоритм відновлення самого паросполучення (як набору ребер, що входять до нього).

## Визначення

Нехай дано граф $G$ з $n$ вершинами ($n$ - парне число).

Значить **матрицею Тутте** (Tutte) називається наступна матриця розмірності $n \times n$:

$$
\begin{pmatrix}
0 & x_{12} & x_{13} & \ldots & x_{1(n-1)} & x_{1n} \cr
-x_{12} & 0 & x_{23} & \ldots & x_{2(n-1)} & x_{2n} \cr
-x_{13} & -x_{23} & 0 & \ldots & x_{3(n-1)} & x_{3n} \cr
\vdots & \vdots & \vdots & \ddots & \vdots & \vdots \cr
-x_{1(n-1)} & -x_{2(n-1)} & -x_{3(n-1)} & \ldots & 0 & x_{(n-1)n} \cr
-x_{1n} & -x_{2n} & -x_{3n} & \ldots & -x_{(n-1)n} & 0 \cr
\end{pmatrix}
$$

де $x_{ij}$ ($1 \le i < j \le n$) - це або незалежна змінна, що відповідає ребру між вершинами $i$ і $j$, або тотожний нуль, якщо ребра між цими вершинами відсутні.

Таким чином, у випадку повного графа з $n$ вершинами матриця Тота містить $n (n-1) / 2$ незалежних змінних. Якщо ж у графі деякі ребра відсутні, то відповідні елементи матриці Тота стають нулями. Загалом, кількість змінних у матриці Тота дорівнює кількості ребер графа.

Матриця Татта є антисиметричною (кососиметричною).

## Теорема Татта

Розглянемо визначник $\det(A)$ матриці Тотта. Це, загалом кажучи, поліном щодо змінних $x_{ij}$.

Теорема Татта свідчить: у графі $G$ існує виконана паросполученість тоді і лише тоді, коли багаточлен $\det(A)$ не є тотожньо рівним нулю (тобто має принаймні один доданок з ненульовим коефіцієнтом). Нагадаємо, що паросполученість називається досконалою, якщо вона насичує всі вершини, тобто її потужність дорівнює $n/2$.

Канадський математик Вільям Томас Татт (William Thomas Tutte) першим вказав на тісний зв'язок між паросочетаннями в графах і визначниками матриць (1947 р.). Більш простий вид цього зв'язку пізніше відкрив Едмондс (Edmonds) у випадку двудольних графів (1967 р.). Рандомізовані алгоритми для знаходження величини максимального паросполука і самих ребер цього паросполука були запропоновані пізніше, відповідно, Ловасем (Lovasz) (у 1979 р.) і Рабіном (Rabin) з Вазірані (Vazirani) (у 1984 р.).

### Практичне застосування: випадковий алгоритм

Безпосередньо застосовувати теорему Татта навіть у задачі перевірки існування виконаного паросполука недоцільно. Причиною цього є те, що при символьному обчисленні визначника (тобто у вигляді багаточленів над змінними $x_{ij}$) проміжні результати є многочленами, які містять $O(n^2)$ змінних. Тому обчислення визначника матриці Татта у символьному вигляді вимагає невиправдано багато часу.

Угорський математик Ласло Ловаш (László Lovász) був першим, хто вказав на можливість застосування **випадкового** алгоритму для спрощення обчислень.

Ідея дуже проста: замінимо всі змінні $x_{ij}$ випадковими числами

$$
x_{ij} = {\rm rand}().
$$

Отже, якщо поліном $\det(A)$ був тотожно нульовим, то після такої заміни він залишиться нульовим. Якщо ж він був відмінним від нуля, то при такій випадковій числовій заміні ймовірність того, що він стане нульовим, досить мала. Також слід замінити "случайная" на "випадкова". Російське слово "отличным" потрібно замінити на "відмінним".

Зрозуміло, що такий тест (підстановка випадкових значень і обчислення визначника $ \det(A)$) якщо й помиляється, то тільки в одну сторону: можливо повідомити про відсутність здійсненого паросполуку, коли насправді він існує.

Ми можемо повторити цей тест декілька разів, підставляючи в якості значень змінних нові випадкові числа, і з кожним повторним запуском ми отримуємо все більшу впевненість у тому, що тест видає правильну відповідь. На практиці у більшості випадків достатньо одного тесту, щоб визначити, чи є в графі паросполука, або ні; декілька таких тестів дають вже дуже високу ймовірність.

Для оцінки **ймовірності помилки** можна використовувати лему Шварца-Зіппеля (Schwartz–Zippel), яка свідчить, що ймовірність обернення в нуль ненульового полінома $P$ $k$-го степеня при підстановці в якості значень змінних випадкових чисел, кожне з яких може приймати $s$ варіантів значень, - ця ймовірність задовольняє нерівності:

$$
{\rm Pr}[P(r_1,\ldots,r_k)=0] \le \frac{k}{s}.
$$

Наприклад, при використанні стандартної функції випадкових чисел у мові C++ $\rm rand()$ отримуємо, що ймовірність цього становить близько одного відсотка при $n=300$.

Асимптотика розв'язку дорівнює $O(n^3)$ (з використанням, наприклад, [алгоритму Гауса](determinant_gauss)), помноженого на кількість ітерацій тесту. Слід зазначити, що за асимптотикою такий розв'язок значно відстає від розв'язку [алгоритмом Едмондса стиснення квіток](matching_edmonds), проте в деяких випадках його більш переваги з-за простоти реалізації.

**Відновити** саме вчинену паросполуку як набір ребер є більш складною задачею. Найпростішим, хоча і повільним, варіантом буде відновлення цієї паросполуки по одному ребру: перебираємо перше ребро відповіді, вибираємо його так, щоб в залишку графу існувала вчинена паросполука, і т.д.

### Доведення теореми Татта

Щоб добре зрозуміти доведення цієї теореми, спочатку розглянемо більш простий результат, - отриманий Едмондсом для випадку двудольних графів.

#### Теорема Едмондса

Розглянемо двудольний граф, в кожній частині якого є $n$ вершин. Складемо матрицю $B$ розмірності $n \times n$, в якій, аналогічно до матриці Татта, $b_{ij}$ є окремою незалежною змінною, якщо ребро $(i,j)$ присутнє в графі, і є тотожньою нулем у іншому випадку.

Ця матриця схожа на матрицю Татта, проте матриця Едмондса має вдвічі меншу різницю, і кожному ребру тут відповідає лише одна комірка матриці.

Доведемо наступну **теорему**: визначник $\det(B)$ відмінний від нуля тоді і тільки тоді, коли в двудольному графі існує відповідна паросполука.

Доведення. Розпишемо визначник згідно його визначення, як суму по всіх перестановках:

$$
\det(B) = \sum_{\pi \in S_n} {\rm sgn}(\pi) \cdot b_{1,\pi_1} \cdot b_{2,\pi_2} \cdot \ldots \cdot b_{n,\pi_n}.
$$

Зауважимо, що оскільки всі ненульові елементи матриці $B$ - різні незалежні змінні, то в цій сумі всі ненульові доданки є різними, а тому жодного скорочення в процесі підсумовування не відбувається. Залишається зауважити, що будь-який ненульовий доданок в цій сумі означає неперетинну множину ребер, тобто деяку паросполучення. І навпаки, будь-якому синглетному паросполученню відповідає ненульовий доданок в цій сумі. Разом з вищезазначеним це доводить теорему.

#### Властивості антисиметричних матриць

Для доведення теореми Татта необхідно скористатися кількома відомими фактами лінійної алгебри про властивості антисиметричних матриць.

**По-перше**, якщо антисиметрична матриця має непарний розмір, то її визначник завжди дорівнює нулю (теорема Якобі (Jacobi)). Для цього достатньо замітити, що антисиметрична матриця задовольняє рівнянню $A^T = -A$, і тепер отримуємо ланцюжок рівностей:

$$
\det(A) = \det(A^T) = \det(-A) = (-1)^n \det(A),
$$

звідки випливає, що при непарних $n$ визначник повинен бути рівний нулю?

По-друге, виявляється, що в разі антисиметричних матриць парного розміру їх визначник завжди можна записати як квадрат деякого полінома відносно змінних-елементів цієї матриці (поліном називається пфаффіаном (pfaffian), а результат належить Мьюру (Muir)):

$$
\det(A) = {\rm Pf}^2(A).
$$

По-третє, цей пфаффіан представляє собою не довільний багаточлен, а суму, зазначену увазі:

$$
{\rm Pf}(A) = \frac{ 1 }{ 2^n n! } \sum_{\pi \in S_n} {\rm sgn(\pi)} \cdot a_{\pi_1,\pi_2} \cdot a_{\pi_3,\pi_4} \cdot \ldots \cdot a_{\pi_{n-1},\pi_n}.
$$

Таким чином, кожен доданок у пфаффіані - це добуток таких $n/2$ елементів матриці, що їх індекси в сукупності складають розбиття множини $n$ на $n/2$ пар. Перед кожним доданком є свій коефіцієнт, але його вид нас тут не цікавить.

#### Доведення теореми Татта

Скориставшись другою та третьою властивістю з попереднього пункту, ми отримуємо, що визначник $\det(A)$ матриці Татта представляє собою квадрат від суми доданків у такий спосіб, що кожен доданок є добутком елементів матриці, індекси яких не повторюються та охоплюють всі номери від $1$ до $n$. Таким чином, знову, як і в доведенні теореми Едмондса, кожен ненульовий доданок цієї суми відповідає ідеальному паросполученню в графі, і навпаки.

## Теорема Ловаша: узагальнення для пошуку розміру максимальної пароспільності

### Формулювання

Ранг матриці Татта збігається з подвоєною величиною максимального паросполука в даному графі.

### Застосування

Для застосування цієї теореми на практиці можна скористатися тим самим прийомом рандомізації, що і в вищеописаному алгоритмі для матриці Татта, а саме: підставити замість змінних випадкові значення і знайти ранг отриманої числової матриці. Ранг матриці, знову ж таки, шукається за $O(n^3)$ з допомогою модифікованого алгоритму Гауса, див. [тут](https://uk.wikipedia.org/wiki/Ранг_матриці).

Втім, потрібно відзначити, що наведена вище лема Шварца-Зіппеля непридатна в явному вигляді, і інтуїтивно здається, що ймовірність помилки тут стає вищою. Однак було доведено (див. роботи Ловаса (Lovasz)), що і в цьому випадку ймовірність помилки (тобто того, що ранг отриманої матриці виявиться меншим, ніж подвійний розмір максимального паросполуку) не перевищує $\frac{n}{s}$ (де $s$, як і вище, позначає розмір множини, з якої вибираються випадкові числа).

### Доведення

Доведення випливає з теореми лінійної алгебри, відомої як **теорема Фробеніуса** (Frobenius). Нехай задана антисиметрична матриця $A$ розміру $n \times n$, і нехай множини $S$ і $T$ - будь-які дві підмножини множини $\{ 1, \ldots, n \}$, причому розміри цих множин збігаються і дорівнюють рангу матриці $A$. Позначимо через $A_{XY}$ матрицю, отриману з матриці $A$ тільки рядками з номерами з множини $X$ і стовпцями з номерами з множини $Y$ (де $X$ і $Y$ - деякі підмножини множини $\{ 1, \ldots, n \}$). Тоді виконується:

$$
\det(A_{SS}) \cdot \det(A_{TT}) = \det(A_{ST}) \cdot \det(A_{TS}).
$$

Покажемо, як ця властивість дозволяє встановити **відповідність** між рангом матриці $A$ Тотта і величиною максимального паросполука.

З однієї сторони, розглянемо у графі $G$ деяку максимальну паросполученість і позначимо множину насичуваних ними вершин як $U$. Оскільки, згідно з теоремою Татта, визначник $\det(A_{UU})$ відмінний від нуля, то ранг матриці Татта дорівнює, як мінімум, $2|U|$, тобто не менше подвоєної величини максимальної паросполученості.

Покажемо тепер зворотню нерівність. Позначимо ранг матриці $A$ через $r$. Це означає, що знайдеться така підматриця $A_{ST}$, де $|S| = |T| = r$, визначник якої відмінний від нуля. Легко помітити, що $A_{TS}$ також буде відмінним від нуля. Але згідно з наведеною вище теоремою Фробеніуса це означає, що обидві матриці $A_{SS}$ і $A_{TT}$ мають ненульовий визначник. Звідси випливає, що $r$ парне (тому що, як було зазначено вище, антисиметрична матриця непарної розмірності завжди має нульовий визначник). Таким чином, ми можемо застосувати до підматриці $A_{SS}$ (або $A_{TT}$) теорему Татта. Отже, в підграфі, індукованому множиною вершин $S$ (або множиною вершин $T$), є здійснена паросполученість (і його розмірність дорівнює $r/2$). Таким чином, ранг матриці Татта не може бути більшим від двої величини максимального розміру паросполучення.

Об'єднуючи дві доведені нерівності, ми отримуємо твердження теореми: ранг матриці Татта дорівнює подвоєній величині максимального паросполучення.

## Алгоритм Рабіна-Карпа знаходження максимального паросполука

Цей алгоритм є подальшим узагальненням двох попередніх теорем і дозволяє, на відміну від них, видаляти не лише величину максимального паросполука, але і самі ребра, які входять в нього.

### Формулювання теореми

Нехай в графі існує здійснена паросполученість. Значить, його матриця Татта невироджена, тобто $\det(A) \ne 0$. Згенеруємо за допомогою описаного вище методу випадкову числову матрицю $B$ на основі цієї матриці. Тоді з високою ймовірністю $(B^{-1})_{ji} \ne 0$ тоді й тільки тоді, коли ребро $(i,j)$ належить якій-небудь здійсненій паросполученості.

(Тут через $B^{-1}$ позначена зворотна матриця до $B$. Передбачається, що детермінант матриці $B$ відмінний від нуля, тому зворотна матриця існує).

### Застосування

Цю теорему можна застосувати для відновлення самих ребер максимального паросполука. Спочатку потрібно виділити підграф, в якому міститься шуканий максимальний паросполук (це можна зробити паралельно з алгоритмом пошуку рангу матриці).

Після цього задача зводиться до пошуку відповідного паросполука за допомогою даної числової матриці, яка отримується з матриці Татта. Тут ми застосовуємо теорему Рабіна-Вазирани і знаходимо зворотну матрицю (що можна зробити модифікованим алгоритмом Гауса за $O(n^3)$). Знаходимо в ній будь-який ненульовий елемент, видаляємо його з графа і повторюємо процес. Асимптотика такого розв'язку буде не найшвидшою - $O(n^4)$, але зате ми отримуємо простоту розв'язку (порівняно, наприклад, з [алгоритмом Едмондса стиснення квіток](matching_edmonds)).

### Доведення теореми

Згадаймо відому формулу для елементів оберненої матриці $B^{-1}$:

$$
(B^{-1})_{ji} = \frac{ {\rm adj}(B)_{i,j} }{ \det(B) },
$$

де через ${\rm доп}(B)_{i,j}$ позначено алгебраїчне доповнення, тобто число $(-1)^{i+j}$, помножене на визначник матриці, отриманої з $B$ видаленням $i$-го рядка і $j$-го стовпця.

Звідси одразу отримуємо, що елемент $(B^{-1})_{ji}$ дорівнює нулю, якщо матриця $B$ з викресленими $i$-м рядком та $j$-м стовпцем має нульовий визначник. Застосовуючи теорему Татта, це означає з високою ймовірністю, що в графі без вершин $i$ та $j$ як і раніше існує відповідна паросполученість.

## Література

* \book{William Thomas Tutte}{The Factorization of Linear Graphs}{1946}{tutte.pdf}
* \book{Laszlo Lovasz}{On Determinants, Matchings and Random Algorithms}{1979}
* \book{Laszlo Lovasz, M.D. Plummer}{Matching Theory}{1986}{lovasz_plummer.pdf}
* \book{Michael Oser Rabin, Vijay V. Vazirani}{Maximum matchings in general graphs through randomization}{1989}
* \book{Allen B. Tucker}{Computer Science Handbook}{2004}{tucker.pdf}
* \book{Rajeev Motwani, Prabhakar Raghavan}{Randomized Algorithms}{1995}{motwani.djvu}
* \book{A.C. Aitken}{Determinants and matrices}{1944}{aitken.pdf}