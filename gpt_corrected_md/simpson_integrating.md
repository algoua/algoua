# Інтегрування за формулою Сімпсона

Потрібно порахувати значення визначеного інтегралу:

$$
\int_a^b f(x) dx
$$

Розв'язок, описаний тут, був опублікований в одній з дисертацій **Томаса Сімпсона** (Thomas Simpson) у 1743 році.

## Формула Сімпсона

Нехай $n$ - деяке натуральне число. Розіб'ємо відрізок інтегрування $[a;b]$ на $2n$ рівні частини:

$$
x_i = a + i h,~~i = 0 \ldots 2n,
$$

$$
h = \frac{ b-a }{ 2n }.
$$

Тепер порахуємо інтеграл окремо на кожному з відрізків $[x_{2i-2}, x_{2i}], i = 1 \ldots n$, а потім додамо всі значення.

Отже, нехай ми розглядаємо наступний відрізок $[x_{2i-2}, x_{2i}], i = 1 \ldots n$. Замінимо функцію $f(x)$ на цьому відрізку параболою, що проходить через три точки $(x_{2i-2},f(x_{2i-2})), (x_{2i-1},f(x_{2i-1})), (x_{2i},f(x_{2i}))$. Така парабола завжди існує і єдинствена. Її можна знайти аналітично, після чого залишиться тільки проінтегрувати вираз для неї, і отримати наступний результат:

$$
\int_{x_{2i-2}}^{x_{2i}} f(x) dx = \left( f(x_{2i-2}) + 4 f(x_{2i-1}) + f(x_{2i}) \right) \frac{ h }{ 3 }.
$$

Складаючи ці значення по всіх відрізках, отримуємо кінцеву **формулу Сімпсона**:

$$
\int_a^b f(x) dx = \left( f(x_0) + 4 f(x_1) + 2 f(x_2) + 4 f(x_3) + 2 f(x_4) + \ldots + 4 f(x_{2N-1}) + f(x_{2N}) \right) \frac{ h }{ 3 }.
$$

## Погрешность

Похибка, яку дає формула Сімпсона, не перевищує за модулем величину:

$$
\frac{ 1 }{ 180 } h^4 (b - a) \max_{a \le x \le b} \left| f^{(4)}(x) \right|.
$$

Таким чином, порядок похибки зменшується з ростом $n$ і дорівнює $O(n^4)$.

## Реалізація

Тут $f(x)$ - деяка користувацька функція.

<!--- TODO: specify code snippet id -->
``` cpp
double a, b;               // вхідні дані
кількість кроків (вже помножена на 2): const int N = 1'000'000;
double s = 0;
double h = (b - a) / N;
for (int i = 0; i <= N; ++i) {
    double x = a + h * i;
    s += f(x) * ((i == 0 || i == N) ? 1 : ((i & 1) == 0) ? 2 : 4);
}
s *= h / 3;
```