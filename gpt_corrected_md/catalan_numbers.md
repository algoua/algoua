# Числа Каталана

Числа Каталана - числова послідовність, яка зустрічається в багатьох комбінаторних задачах.

Ця послідовність називається на честь бельгійського математика Каталана (Catalan), який жив у 19 столітті, хоча насправді вона була відома ще Ейлеру (Euler), який жив за століття до Каталана.

## Послідовність

Перші декілька чисел Каталана $C_n$ (починаючи з нульового):

$$
1,\ 1,\ 2,\ 5,\ 14,\ 42,\ 132,\ 429,\ 1430,\ \ldots
$$

Числа Каталана зустрічаються в великій кількості задач комбінаторики. $n$-е число Каталана - це:

* Кількість корректных дужкових послідовностей, складаються з $n$ відкривають і $n$ закрывающих дужок.
* Кількість кореневих бінарних дерев з $n+1$ листком (вершини не пронумеровані).
* Кількість способів повністю розділити дужками $n+1$ множник.
* Кількість триангуляций выпуклого $n+2$-угольника (тобто кількість розбиття багатокутника непересічними диагоналями на трикутники).
* Кількість способів з'єднати $2n$ точок на колі $n$ непересічними хордами.
* Кількість незізнаваних повних бінарних дерев з $n$ внутрішніми вершинами (тобто мають хоча б одного нащадка).
* Кількість монотонних шляхів з точки $(0,0)$ до точки $(n,n)$ в квадратній решітці розміром $n \times n$, які не перетинають головну діагональ, дорівнює $C_n$, де $C_n$ - $n$-е число Каталана.
* Кількість перестановок довжини $n$, які можна відсортувати стеком (можна показати, що перестановка є сортируемой стеком тоді і тільки тоді, коли ні таких індексів $i<j<k$, що $a_k<a_i<a_j$).
* Кількість неперервних розбиттів множини з $n$ елементів (тобто розбиття на неперервні блоки).
* Кількість способів покрити лесенку $1 \ldots n$ допомогою $n$ прямокутників (мається на увазі фігура, що складається з $n$ стовпчиків, $i$-й з яких має висоту $i$) дорівнює добутку чисел $1, 2, \ldots, n-1, n$, тобто $n!$.

## Обчислення

Є дві формули для чисел Каталана: рекурентна і аналітична. Оскільки ми припускаємо, що всі наведені вище задачі еквівалентні, то для доведення формул ми будемо вибирати ту задачу, за допомогою якої це зробити найпростіше.

### Рекурентна формула

$$
C_n = \sum_{k=0}^{n-1} C_k C_{n-1-k}
$$

Рекурентну формулу легко вивести з задачі про правильні дужкові послідовності.

Самой лівої відкриває скобці l відповідає певна закриває дужка r, яка розбиває формулу дві частини, кожна з яких в свою чергу є правильної дужковій послідовністю. Тому, якщо ми позначимо $k = r-l-1$, то для будь-якого фіксованого $r$ буде рівне $C_k C_{n-1-k} $ способів. Суммируя це по всім допустимым $k$, ми і отримуємо рекурентну залежність на $C_n$.

### Аналітична формула

$$
C_n = \frac{1}{n+1} C_{2n}^{n}
$$

(Тут через $C_n^k$ позначено, як зазвичай, біноміальний коефіцієнт.)

Цю формулу найпростіше отримати з задачі про монотонні шляхи. Загальна кількість монотонних шляхів в решітці розміром $n \times n$ дорівнює $C_{2n}^{n}$. Тепер порахуємо кількість монотонних шляхів, які перетинають діагональ. Розглянемо будь-який з таких шляхів і знайдемо перше ребро, яке перетинає діагональ зверху вниз. Відобразимо весь шлях після цього ребра відносно діагоналі. В результаті отримаємо монотонний шлях в решітці розміром $(n-1) \times (n+1)$. Але з іншого боку, будь-який монотонний шлях в решітці розміром $(n-1) \times (n+1)$ обов'язково перетинає діагональ, отже, він отримується саме таким чином з якогось (і єдиного) монотонного шляху, який перетинає діагональ в решітці розміром $n \times n$. Кількість монотонних шляхів в решітці розміром $(n-1) \times (n+1)$ дорівнює $C_{2n}^{n-1}$. Отже, маємо формулу:

$$
C_n = C_{2n}^{n} - C_{2n}^{n-1} = \frac{1}{n+1} C_{2n}^{n}
$$