# Перетворення геометричної інверсії

Перетворення геометричної інверсії - це особливий тип перетворення точок на площині. Практична користь цього перетворення полягає в тому, що найчастіше воно дозволяє звести розв'язок геометричної задачі **з колами** до розв'язку відповідної задачі **з прямими**, яка зазвичай має набагато простіший розв'язок.

З усієї видимості, засновником цього напрямку математики був Людвіг Іммануїл Магнус (Ludwig Immanuel Magnus), який у 1831 р. опублікував статтю про інверсні перетворення.

## Визначення

Зафіксуємо коло з центром у точці $O$ радіусу $r$. Означимо **інверсією** точки $P$ щодо цього кола таку точку $P^\prime$, яка лежить на лучі $OP$ і відстань від якої до центра кола задовольняє умову:

$$
OP \cdot OP^\prime = r^2.
$$

\img{inversion_3.png}

Якщо вважати, що центр кола $O$ співпадає з початком координат, то можна сказати, що точка $P^\prime$ має той самий полярний кут, що й $P$, а відстань обчислюється за вищезгаданою формулою.

У термінах **комплексних чисел** перетворення інверсії виражається досить просто, якщо припустити, що центр кола $O$ збігається з початком координат:

$$
z^\prime = r^2 \cdot \frac{ z }{ |z|^2 }.
$$

За допомогою спряженого елементу $\overline{z}$ можна отримати більш просту форму:

$$
z^\prime = \frac{ r^2 }{ \overline{z} }.
$$

Застосування інверсії (у точці-середині дошки) до зображення шахівниці дає цікавий малюнок (праворуч):

\img{inversion_9.png}

## Властивості

Очевидно, що будь-яка точка, що лежить **на колі**, щодо якого виконується перетворення інверсії, при відображенні переходить в себе ж. Будь-яка точка, що лежить **всередині** кола, переходить у **зовнішню** область, і навпаки. Вважається, що центр кола переходить в точку "нескінченність" $\infty$, а точка "нескінченність" - навпаки, в центр кола

$$
(O)^\prime = \infty,
$$

$$
(\infty)^\prime = O.
$$

Очевидно, що повторне застосування перетворення інверсії скасовує перше її застосування - всі точки повертаються назад

$$
\left( P^\prime \right) ^\prime \equiv P.
$$

### Обобщённые кола

Об'єднане коло - це або коло, або пряма (вважається, що це теж коло, але має нескінченний радіус).

Ключова властивість перетворення інверсії полягає в тому, що при його застосуванні будь-яке коло **завжди переходить в інше коло** (мається на увазі, що перетворення інверсії застосовується до всіх точок фігури).

Зараз ми побачимо, що саме відбувається з прямими та колами під час перетворення інверсії.

### Інверсія прямої, яка проходить через точку $O$

Стверджується, що будь-яка пряма, що проходить через $O$, після перетворення інверсії **залишається незмінною**.

Насправді, будь-яка точка цієї прямої, крім $O$ та $\infty$, переходить, по визначенню, також на цю ж пряму (причому в підсумку отримані точки заповнять всю пряму цілком, оскільки перетворення інверсії є оберненим). Залишаються точки $O$ та $\infty$, але при інверсії вони переходять одна в одну, тому доведення завершено.

### Пряма, яка проходить через точку $O$, не інвертується

Стверджується, що будь-яка така пряма перейде **в коло**, що проходить через $O$.

\img{inversion_4.png}

Розглянемо будь-яку точку $P$ на цій прямій, і також розглянемо точку $Q$ - найближчу до $O$ точку на прямій. Зрозуміло, що відрізок $OQ$ перпендикулярний прямій, тому кут $\angle PQO$, який вони утворюють, є прямим. Крім того, текст містить російський вислів "образуемый ими", який потрібно замінити на "утворюваний ними".

Скористаємося тепер **лемою про рівні кути**, яку ми доведемо трохи пізніше. Ця лема дає нам рівність:

$$
\angle PQO = \angle Q^\prime P^\prime O.
$$

Отже, кут $\angle Q'P'O$ також є прямим. Оскільки ми взяли точку $P$ довільно, то випливає, що точка $P'$ лежить на колі, побудованому на $OQ'$ як на діаметрі. Легко зрозуміти, що в результаті всі точки прямої лежать на цьому колі повністю, отже, твердження доведено.

### Інверсія кола, яке проходить через точку $O$

Будь-яке коло, що перетинає пряму, але не проходить через точку $O$.

Насправді, це випливає з попереднього пункту, якщо ми згадаємо про оборотність перетворення інверсії.

### Інверсія кола, яке не проходить через точку $O$

Будь-яке коло, що перетинає коло, як і раніше проходить через точку $O$.

\img{inversion_5.png}

Насправді, розглянемо будь-яке таке коло $Z$ з центром у точці $O_2$. З'єднаємо центри $O$ і $O_2$ кола прямою; ця пряма перетне коло $Z$ в двох точках $S$ і $T$ (очевидно, $ST$ - діаметр $Z$).

Тепер розглянемо будь-яку точку $P$, що лежить на колі $Z$. Кут $\angle SPT$ є прямим для будь-якої такої точки, але згідно з **лемою про рівні кути**, кут $\angle S^\prime P^\prime T^\prime$ також є прямим. Звідси випливає, що точка $P^\prime$ лежить на колі, побудованому на відрізку $S^\prime T^\prime$ як на діаметрі. Легко зрозуміти, що всі образи $P^\prime$ в підсумку покриють цей коло. Русизми виправлені.

Зрозуміло, що це нове коло не можна проходити через $O$: інакше точка $\infty$ повинна була належати старому колу.

### Лема про рівні кути

Це допоміжна властивість, яка була використана вище при аналізі результатів перетворення інверсії.

#### Формулювання

Розглянемо будь-які дві точки $P$ і $Q$, і застосуємо до них перетворення інверсії, отримаємо точки $P^\prime$ і $Q^\prime$. Значить наступні кути будуть рівні:

$$
\angle PQO = \angle Q^\prime P^\prime O,
$$

$$
\angle QPO = \angle P^\prime Q^\prime O.
$$

#### Доведення

Доведемо, що трикутники $\triangle QPO$ і $\triangle Q^\prime P^\prime O$ подібні (порядок вершин важливий!).

\img{inversion_1.png}

Насправді, за визначенням, перетворення інверсії має такий вигляд:

$$
OP \cdot OP^\prime = r^2,
$$

$$
OQ \cdot OQ^\prime = r^2,
$$

звідки отримуємо рівність:

$$
OP \cdot OP^\prime = OQ \cdot OQ^\prime,
$$

$$
\frac{ OP }{ OQ } = \frac{ OQ^\prime }{ OP^\prime }.
$$

Таким чином, трикутники $\triangle PQO$ і $\triangle Q^\prime P^\prime O$ мають спільний кут, а дві прилеглі до нього сторони пропорційні, отже, ці трикутники подібні, і тому відповідні кути збігаються.

#### Слідство з леми

Якщо дано будь-які три точки $P$, $Q$ і $R$, причому точка $R$ лежить на відрізку $PQ$, то виконується:

$$
\angle QPR = \angle Q^\prime P^\prime R^\prime,
$$

причому ці кути орієнтовані в різні боки (тобто якщо розглядати ці два кути як орієнтовані, то вони мають різний знак).

\img{inversion_2.png}

Для доведення зауважимо, що кут $\angle QPR$ є різницею двох кутів $\angle QPO$ і $\angle RPO$, до кожного з яких можна застосувати лему про рівні кути:

$$
\angle QPR = \angle QPO - \angle RPO = \angle P^\prime Q^\prime O - \angle P^\prime R^\prime O = \angle R^\prime P^\prime Q^\prime = \angle Q^\prime P^\prime R^\prime.
$$

Під час здійснення останнього переходу ми змінили порядок розташування точок, що означає зміну орієнтації кута на протилежну.

### Конформность

Перетворення інверсії є конформним, тобто **зберігає кути в точках перетину кривих**. При цьому, якщо кути розглядати як орієнтовані, то орієнтація кутів при застосуванні інверсії змінюється на протилежну.

\img{inversion_6.png}

Для **доведення** цього розглянемо дві довільні криві, які перетинаються в точці $P$ і мають в ній дотичні. Нехай по першій кривій буде йти точка $Q$, по другій - точка $R$ (ми їх устремимо в границі до $P$).

Очевидно, що після застосування інверсії криві будуть, як і раніше, перетинатися (якщо, звісно, вони не проходили через точку $O$, але такий випадок ми не розглядаємо), і точкою їх перетину буде $P^\prime$.

Враховуючи, що точка $R$ лежить на прямій, яка з'єднує $O$ і $Q$, отримуємо, що можемо застосувати наслідок з леми про рівні кути, з якої ми отримуємо:

$$
\angle QPR = - \angle Q^\prime P^\prime R^\prime,
$$

де під знаком "мінус" ми розуміємо, що кути орієнтовані в різних напрямках.

Устремлюючи точки $Q$ і $R$ до точки $P$, ми в границі отримуємо, що це рівність - вираз кута між перетинними кривими, що й потрібно довести.

### Властивість відображення

Якщо $M$ - узагальнений коло, то при перетворенні інверсії воно **зберігається**, тоді і тільки тоді, коли $M$ **ортогональне** колу $C$, щодо якого виконується інверсія ($M$ і $C$ вважаються різними).

Доведення цієї властивості цікаве тим, що воно **демонструє** застосування геометричної інверсії для уникнення кол і спрощення задачі.

Першим кроком доведення буде вказання на той факт, що $M$ та $C$ мають як мінімум дві точки перетину. Насправді, перетворення інверсії щодо $C$ відображає внутрішність кола в її зовнішність та навпаки. Оскільки $M$ залишається незмінним після перетворення, це означає, що вона містить точки як з внутрішності, так і з зовнішності кола $C$. Звідси випливає, що точок перетину дві (неможливо мати одну точку перетину - це означає касання двох коліс, але цей випадок очевидно неможливо за умови; кола не можуть перетинатись в одній точці згідно з визначенням).

Позначимо одну точку перетину як $A$, іншу - як $B$. Розглянемо довільне коло з центром у точці $A$ і виконаємо перетворення інверсії щодо неї. Зауважимо, що тоді і коло $C$, і узагальнене коло $M$ перетворюються в перетинні прямі. Враховуючи конформність перетворення інверсії, отримуємо, що $M$ і $M^\prime$ збігаються тоді і тільки тоді, коли кут між цими перетинними прямими є прямим кутом (насправді, перше перетворення інверсії, - щодо $C$, - змінює напрям кута між колами на протилежний, тому якщо коло збігається зі своєю інверсією, то кути між перетинними прямими з обох сторін повинні збігатися та дорівнювати $\frac{180}{2} = 90$ градусів).

## Практичне застосування

Відразу варто відзначити, що при застосуванні в розрахунках потрібно враховувати велику **помилку**, внесену перетворенням інверсії: можуть з'являтися дробові числа дуже малих порядків, і зазвичай через високу похибку метод інверсії добре працює тільки з порівняно невеликими координатами.

### Побудова фігур після інверсії

У програмних обчисленнях зазвичай зручніше та надійніше використовувати не готові формули для координат та радіусів отриманих загальних кол, а відновлювати кожного разу прямі/кола по двом точкам. Якщо для відновлення прямої достатньо взяти будь-які дві точки, обчислити їх образи та з'єднати пряму, то з колами все набагато складніше.

Якщо ми хочемо знайти коло, що утворилося в результаті інверсії прямої, то, згідно вищезазначених виразів, потрібно знайти найближчу до центру інверсії точку $Q$ прямої, застосувати до неї інверсію (отримавши точку $Q^\prime$), і тоді шукане коло матиме діаметр $OQ^\prime$. Рекомендується замінити російське слово "вышеприведенным" на українське "вищезазначених".

Нехай тепер ми хочемо знайти коло, яке отрималося в результаті інверсії іншого кола. Загалом кажучи, центр нового кола не збігається з центром старого кола. Для визначення центру нового кола можна скористатися таким прийомом: провести через центр інверсії та центр старого кола пряму, подивитися на її точки перетину зі старою окружністю, нехай це будуть точки $S$ і $T$. Відрізок $ST$ утворює діаметр старого кола, і легко зрозуміти, що після інверсії цей відрізок, як і раніше, буде утворювати діаметр. Отже, центр нового кола можна знайти як середнє арифметичне точок $S^\prime$ і $T^\prime$.

### Параметры кола після інверсії

Потрібно за заданою коло (з відомими координатами її центру $(x_0, y_0)$ та радіусом $r_0$) визначити, в яке саме коло воно перетвориться після інверсії щодо кола з центром у $(x_c, y_c)$ та радіусом $r$.

тобто, ми вирішуємо задачу, описану в попередньому пункті, але хочемо отримати розв'язок у аналітичному вигляді.

Відповідь виглядає в вигляді формул:

$$
x^\prime = x_c + s (x_0 - x_c),
$$

$$
y^\prime = y_c + s (y_0 - y_c),
$$

$$
r^\prime = |s| \cdot r_0,
$$

де

$$
s = \frac{ r^2 }{ (x_0 - x_c)^2 + (y_0 - y_c)^2 - r_0^2 }.
$$

Мнемонічно ці формули можна запам'ятати так: центр кола переходить "майже" як за преобразуванням інверсії, тільки в знаменнику крім $|z|^2 = (x_0 - x_c)^2 + (y_0 - y_c)^2$ з'явилося ще віднімане $r_0^2$.

Виводяться ці формули, що дорівнюють описаному в попередньому пункті алгоритму: спочатку знаходяться вирази для двох діаметральних точок $S$ і $T$, далі до них застосовується інверсія, і потім береться середнє арифметичне їх координат. Аналогічно можна порахувати і радіус як половину довжини відрізку $ST$.

### Застосування в доведеннях: задача про розбиття точок колом

Дано $2n$ різних точок на площині, а також довільна точка $O$, відмінна від усіх інших. Доведіть, що існує коло, яке проходить через точку $O$, і всередині та зовні його буде лежати однакова кількість точок набору, тобто по $n$ штук.

Для **доведення** зробимо перетворення інверсії щодо обраної точки $O$ (з будь-яким радіусом, наприклад, $r=1$). Отже, шукане коло буде відповідати прямій, яка не проходить через точку $O$. Причому по одну сторону прямої лежить полуплощина, відповідна внутрішності кола, а по іншу - відповідна зовнішності. Зрозуміло, що завжди знайдеться така пряма, яка розбиває множину з $2n$ точок на дві половини по $n$ точок, і при цьому не проходить через точку $O$ (наприклад, таку пряму можна отримати, повернувши всю картину на будь-який такий кут, щоб жодні з розглянутих $2n+1$ точок не мали спільних координат $x$, а потім просто взявши вертикальну пряму між $n$-ою і $n+1$-ою точками). Ця пряма відповідає шуканому колу, яке проходить через точку $O$, отже, твердження доведено.

### Застосування при вирішенні задач обчислювальної геометрії

Чудова властивість геометричної інверсії полягає в тому, що в багатьох випадках вона дозволяє спростити поставлену геометричну задачу, замінюючи розгляд колів лише розглядом прямих.

отже, якщо задача має достатньо складний вигляд з різними операціями з колами, то має сенс застосувати до вхідних даних перетворення інверсії, спробувати вирішити отриману модифіковану задачу без колів (або з меншою їх кількістю), а потім повторним застосуванням інверсії отримати розв'язок вихідної задачі.

Приклад задачі описаний в наступному розділі.

### Ланцюги Штейнера

Дано два кола $C$ і $D$, одне знаходиться всередині іншого. Потім малюється третє коло $E$, яке дотикається до цих двох колів, після чого запускається ітеративний процес: кожного разу малюється нове коло так, щоб воно **доторкалось** попередньо нарисованого та перших двох. Рано або пізно чергове нарисоване коло перетне якесь з вже нарисованих або, принаймні, доторкнеться до нього.

Випадок перетину:

\img{inversion_8.png}

Випадок дотику:

\img{inversion_7.png}

Відповідно, нашою задачею є поставити **якнайбільше** коліс так, щоб перетину (тобто першого з наведених випадків) не було. Перші два кола (зовнішнє і внутрішнє) зафіксовані, ми можемо лише варіювати положення першого кола, що стосується коліс, які касаються, вони ставляться однозначно.

У випадку дотику отримуючий ланцюжок називається **ланцюгом Штейнера**.

Цей ланцюг пов'язаний з так званим **твердженням Штейнера** (поризм Штейнера): якщо існує хоча б один ланцюг Штейнера (тобто існує відповідне становище стартової, що стосується кола, що призводить до ланцюга Штейнера), то при будь-якому іншому виборі стартової, що стосується кола, також буде отримано ланцюг Штейнера, причому кількість кол у ньому буде такою самою.

З цього твердження випливає, що навіть при максимізації кількості колів відповідь не залежить від позиції першого поставленого кола.

Доведення і конструктивний алгоритм розв'язку наступні. Зауважимо, що задача має дуже просте розв'язок у випадку, коли центри зовнішньої і внутрішньої кіл збігаються. Зрозуміло, що в цьому випадку число поставлених кіл ніяк не буде залежати від першого поставленого. У цьому випадку всі круги мають однаковий радіус, і число їх і координати центрів можна порахувати за простими формулами.

Щоб перейти до цієї простої ситуації з будь-якої поданої на вхід, застосуємо перетворення інверсії щодо деякого кола. Нам потрібно, щоб центр внутрішнього кола передвинувся і співпав з центром зовнішнього, тому шукати точку, щодо якої будемо брати інверсію, треба тільки на прямій, яка з'єднує центри кола. Використовуючи формули для координат центру кола після застосування інверсії, можна скласти рівняння на положення центру інверсії та вирішити це рівняння. Тим самим ми з довільної ситуації можемо перейти до простої, симетричної ситуації, а, вирішивши задачу для неї, повторно застосуємо перетворення інверсії і отримаємо розв'язок вихідної задачі.

### Застосування в техніці: прямокутник Липкина-Посельє

Довгий час задача перетворення кругового (вращального) руху в прямолінійний залишалась дуже складною у машинобудуванні, вдавалося знаходити лише наближені розв'язки. І лише в 1864 році офіцер інженерного корпусу французької армії Шарль Ніколя Посельє (Charles-Nicolas Peaucellier) і в 1868 році студент Чебишова Ліпман Ліпкін (Lipman Lipkin) винайшли цей пристрій, оснований на ідей геометричної інверсії. Пристрій отримав назву "прямолінійник Ліпкіна-Посельє" (Peaucellier-Lipkin linkage).

\img{inversion_10.gif}

Щоб зрозуміти роботу пристрою, відзначимо на ньому кілька точок:

\img{inversion_11.png}

Крапка $B$ здійснює обертальний рух по колу (червоного кольору), в результаті чого точка $D$ рухається по прямій (синього кольору). Наша задача полягає в тому, щоб довести, що точка $D$ є інверсією точки $B$ відносно центру $O$ з певним радіусом $r$.

Формалізуємо умову задачі: точка $O$ є жорстко закріпленою, відрізки $OA$ і $OC$ збігаються, а також збігається четвірка відрізків $AB$, $BC$, $CD$, $DA$. Точка $B$ рухається вздовж кола, що проходить через точку $O$. Крім того, будь ласка, замініть "збігається" на "співпадає".

Для **доведення** зауважимо на початку, що точки $O$, $B$ і $D$ лежать на одній прямій (це випливає з рівності трикутників). Позначимо через $P$ точку перетину відрізків $AC$ і $BD$. Введемо позначення:

$$
OB=x,~~~BP=y,~~~AP=h.
$$

Нам потрібно показати, що величина $OB \cdot OD$ є сталою

$$
OB \cdot OD = x(x+2y) = x^2 + 2xy.
$$

За теоремою Піфагора отримуємо:

$$
OA^2 = (x+y)^2 + h^2,
$$

$$
AD^2 = y^2 + h^2.
$$

Візьмімо різницю цих двох величин:

$$
OA^2 - AD^2 = x^2 + 2xy = OB \cdot OD.
$$

Таким чином, ми довели, що $OB \cdot OD = {\rm const}$, що означає, що $D$ є інверсією точки $B$.