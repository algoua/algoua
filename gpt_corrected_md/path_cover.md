# Покриття дорогами орієнтованого ациклічного графа

Даний орієнтований ациклічний граф $G$. Потрібно покрити його найменшим числом простих шляхів, тобто знайти найменшу за потужністю множину шляхів, які не перетинаються по вершинах і кожна вершина належить хоча б одному з цих шляхів. Русизми замінено на українські слова.

## Скориговано: Перетворення на двудольний граф

Нехай дано граф $G$ з $n$ вершинами. Побудуємо відповідний йому двудольний граф $H$ стандартним чином, тобто: в кожній частині графа $H$ буде по $n$ вершин, позначимо їх через $a_i$ і $b_i$ відповідно. Отже, для кожного ребра $(i, j)$ вихідного графа $G$ проведемо відповідне ребро $(a_i, b_j)$.

Кожному ребру графа $G$ відповідає одне ребро графа $H$, і навпаки. Якщо ми розглянемо в графі $G$ будь-який шлях $P = (v_1, v_2, \ldots, v_k)$, то йому ставиться у відповідність набір ребер $(a_{v_1}, b_{v_2}), (a_{v_2}, b_{v_3}), \ldots, (a_{v_{k-1}}, b_{v_k})$.

Більш просто для розуміння буде, якщо ми додамо "зворотні" ребра, тобто створимо граф $\overline H$ з графа $H$ шляхом додавання ребер $(b_i, a_i), i=1 \ldots N$. Отже, шляхи $P = (v_1, v_2, \ldots, v_k)$ в графі $\overline H$ відповідатимуть шляхам $\overline Q = (a_{v_1}, b_{v_2}, a_{v_2}, b_{v_3}, ..., a_{v_{k-1}}, b_{v_k})$.

Назад розглянемо будь-який шлях $\overline Q$ в графі $\overline H$, що починається в першій частині і закінчується в другій частині. Очевидно, $\overline Q$ знову матиме вигляд $\overline Q = (a_{v_1}, b_{v_2}, a_{v_2}, b_{v_3}, \ldots, a_{v_{k-1}}, b_{v_k})$, і йому можна поставити у відповідність в графі $G$ шлях $P = (v_1, v_2, \ldots, v_k)$. Однак тут є одна тонкість: $v_1$ могло збігатися з $v_k$, тому шлях $P$ вийшов би циклом. Однак за умовою граф $G$ ациклічний, тому це взагалі неможливо (це єдине місце, де використовується ациклічність графа $G$; тим не менш, на циклічні графи описаний тут метод взагалі не можна узагальнити).

Отже, будь-якому простому шляху в графі $\overline H$, який починається в першій вершині і закінчується в другій, можна поставити у відповідність простий шлях в графі $G$, і навпаки. Але зауважимо, що такий шлях в графі $\overline H$ - це **паросполука** в графі $H$. Таким чином, будь-який шлях в графі $G$ можна поставити у відповідність паросполуці в графі $H$, і навпаки. Більше того, неперетинаючимся шляхам в $G$ відповідають неперетинаючіся паросполуки в $H$.

Останній крок. Зауважимо, що чим більше шляхів є в нашому наборі, тим менше всі ці шляхи містять ребер. А саме, якщо є $p$ шляхів, які не перетинаються, покривають усі $n$ вершин графа, то вони разом містять $r = n - p$ ребер. Отже, щоб мінімізувати число шляхів, ми повинні **мінімізувати число ребер** в них.

Отже, ми звели задачу до знаходження максимального паросполучення в двудольному графі $H$. Після знаходження цього паросполучення (див. [Алгоритм Куна](https://uk.wikipedia.org/wiki/Алгоритм_Куна)) ми повинні перетворити його в набір шляхів в $G$ (це робиться тривіальним алгоритмом, не виникає неоднозначностей). Деякі вершини можуть залишитися ненасиченими паросполученням, в такому випадку до відповіді потрібно додати шляхи нульової довжини з кожної з цих вершин.

## Взважений випадок

Взважений випадок не сильно відрізняється від невзваженого, просто в графі $H$ на ребрах з'являються ваги, і потрібно знайти паросполуку найменшої ваги. Відновлюючи відповідь аналогічно невзваженому випадку, ми отримаємо покриття графа найменшою кількістю шляхів, а при рівності - найменшою за вартістю.