# Діаграма Вороного у 2D

## Визначення

Дано $n$ точок $P_i(x_i,y_i)$ на площині. Розглянемо розбиття площини на $n$ областей $V_i$ (називається множина многоугольників Вороного або ячейок Вороного, іноді - множина многоугольників близькості, ячейок Діріхле, розбиття Тіссена), де $V_i$ - множина всіх точок площини, які знаходяться ближче до точки $P_i$, ніж до всіх інших точок $P_k$:

$$
V_i = \{ (x,y): \rho ((x,y), P_i) = \min_{ k = 1 \ldots N } \rho ((x,y), P_k) \}
$$

Саме розбиття площини називається діаграмою Вороного даного набору точок $P_k$.

Тут $\rho(p,q)$ - задана метрика, зазвичай це стандартна Євклідова метрика: $\rho(p,q) = \sqrt{ (x_p-x_q)^2 + (y_p-y_q)^2 }$, однак нижче буде розглянуто і випадок так званої Мангеттенської метрики. Тут і далі, якщо не оговорено інше, буде розглядатися випадок Євклідової метрики

Ячейки Вороного є выпуклими багатокутниками, деякі з яких є нескінченними. Точки, що належать одночасно декільком осередкам Вороного, зазвичай відносять до всіх цих осередків (у випадку Евклідової метрики множина таких точок має міру нуль; у випадку мангетенської метрики все дещо складніше).

Такі багатокутники вперше були глибоко досліджені українським математиком Вороним (1868-1908 рр.).

## Властивості

* Діаграма Вороного є планарним графом, тому має $O(n)$ вершин і ребер.

* Зафіксуємо будь-який $i=1 \ldots n$. Отже, для кожного $j=1 \ldots n$, $j \ne i$, проведемо пряму - серединний перпендикуляр відрізку $(P_i,P_j)$; розглянемо ту півплощину, утворену цією прямою, в якій знаходиться точка $P_i$. Отже, перетин всіх півплощин для кожного $j$ дасть осередок Вороного $P_i$.

* Кожна вершина діаграми Вороного є центром кола, яке проходить через будь-які три точки множини $P$. Ці кола істотно використовуються у багатьох доказах, пов'язаних з діаграмами Вороного.

* Ячейка Вороного $V_i$ є нескінченною тоді й тільки тоді, коли точка $P_i$ лежить на кордоні опуклої оболонки множини $P_k$.

* Розглянемо граф, двоїстий до діаграми Вороного, тобто у цьому графі вершинами будуть точки $P_i$, а ребро проводиться між точками $P_i$ і $P_j$, якщо їх осередки Вороного $V_i$ і $V_j$ мають спільне ребро. Значить, за умови, що жодні чотири точки не лежать на одному колі, двоїстий до діаграми Вороного граф є триангуляцією Делоне (що має безліч цікавих властивостей).

## Застосування

Діаграма Вороного представляє собою компактну структуру даних, яка зберігає всю необхідну інформацію для вирішення множини задач про відстані.

У розглянутих нижче завданнях час, необхідний на побудову самої діаграми Вороного, в асимптотиці не враховується.

* Знаходження найближчої точки для кожної точки.

Відзначимо простий факт: якщо для точки $P_i$ найближча є точка $P_j$, то ця точка $P_j$ має "своє" ребро в осередку $V_i$. Звідси випливає, що, щоб знайти для кожної точки найближчу до неї, достатньо переглянути ребра її осередку Вороного. Однак кожне ребро належить рівно двом осередкам, тому буде переглянуто двічі, і вслідкуванням лінійності числа ребер ми отримуємо розв'язок даної задачі за $O(n)$.

* Знаходження опуклої оболонки.

Згадаймо, що вершина належить опуклій оболонці тоді і тільки тоді, коли її комірка Вороного нескінченна. Отже, знайдемо в діаграмі Вороного будь-яке нескінченне ребро і почнемо рухатися в якомусь фіксованому напрямку (наприклад, проти годинникової стрілки) по осередку, що містить це ребро, поки не дійдемо до наступного нескінченного ребра. Потім перейдемо через це ребро в сусідній осередок і продовжимо обхід. В результаті всі пройдені ребра (крім нескінченних) будуть сторонами шуканої опуклої оболонки. Очевидно, час роботи алгоритму - $O(n)$.

* Знаходження мінімального остовного дерева за алгоритмом Евкліда.

Потрібно знайти мінімальне каркасне дерево з вершинами в заданих точках $P$, що з'єднує всі ці точки. Якщо застосовувати стандартні методи теорії графів, то, оскільки граф в даному випадку має $O(n^2)$ ребер, навіть оптимальний алгоритм матиме не меншу асимптотику.

Розглянемо граф, двоїсту діаграму Вороного, тобто триангуляцію Делоне. Можна показати, що знаходження Евклідового мінімального острову еквівалентно побудові острову триангуляції Делоне. Дійсно, у [алгоритмі Пріма](mst_prim) кожного разу шукається найкоротше ребро між двома множинами точок; якщо ми зафіксуємо точку однієї множини, то найближча до неї точка матиме ребро до осередку Вороного, тому в триангуляції Делоне буде присутнє ребро до найближчої точки, що і потрібно довести.

Триангуляція є планарним графом, тобто має лінійне число ребер, тому до неї можна застосувати [алгоритм Пріма](mst_prim) і отримати алгоритм з часом роботи $O(n \log n)$.

* Знаходження найбільшого порожнього кола.

Потрібно знайти коло з найбільшим радіусом, яке не містить жодної з точок $P_i$. Центр кола повинен знаходитись всередині опуклої оболонки цих точок. Зауважимо, що функція найбільшого радіусу кола в даній точці $f(x,y)$ є строго монотонною всередині кожної клітини Вороного. Отже, вона досягає свого максимуму в одній з вершин діаграми Вороного або в точці перетину ребер діаграми та опуклої оболонки (а кількість таких точок не перевищує вдвічі кількість ребер діаграми). Таким чином, залишається тільки перебрати згадані точки і для кожної знайти найближчу. Отже, розв'язок має складність $O(n)$.

## Простий алгоритм побудови діаграми Вороного має складність $O(n^4)$

Діаграми Вороного - досить добре вивчений об'єкт, і для них отримано безліч різних алгоритмів, які працюють з оптимальною асимптотикою $O(n \log n)$, а деякі з цих алгоритмів навіть працюють в середньому за $O(n)$. Однак усі ці алгоритми дуже складні.

Розглянемо тут найпростіший алгоритм, заснований на зазначеній вище властивості, що кожна комірка Вороного представляє собою перетин півплощин. Зафіксуємо $i$. Проведемо між точкою $P_i$ і кожною точкою $P_j$ пряму - серединний перпендикуляр, потім перетнемо попарно всі отримані прямі - отримаємо $O(n^2)$ точок, і кожну перевіримо на належність всім $n$ півплощинам. В результаті за $O(n^3)$ дій ми отримаємо всі вершини центроїду Вороного $V_i$ (їх вже буде не більше $n$, тому ми можемо без ухудшення асимптотики відсортувати їх по полярному куту), а всього на побудову діаграми Вороного буде потрібно $O(n^4)$ дій.

## Випадок особливої метрики

Розгляньмо наступну метрику:

$$
\rho(p,q) = \max (|x_p-x_q|, |y_p-y_q|)
$$

Початок розгляду випливає з аналізу найпростішого випадку - випадку двох точок $A$ та $B$.

Якщо $A_x=B_x$ або $A_y=B_y$, то діаграма Вороного для них буде відповідно вертикальною або горизонтальною прямою.

Інакше діаграма Вороного матиме вигляд "кутника": відрізок під кутом $45$ градусів в прямокутнику, утвореному точками $A$ та $B$, та горизонтальні/вертикальні промені з його кінців в залежності від того, яка зі сторін прямокутника є довшою - вертикальна чи горизонтальна. 

Особливий випадок - коли цей прямокутник має однакову довжину і ширину, тобто $|A_x-B_x| = |A_y-B_y|$. У цьому випадку будуть мати місце дві нескінченні області ("кути", утворені двома променями, паралельними осям), які за визначенням повинні належати одразу обом осередкам. В такому випадку додатково в умові визначають, як розуміти ці області (іноді штучно вводять правило, за яким кожний кут належить до свого осередку).

Таким чином, навіть для двох точок діаграма Вороного в даній метриці представляє собою нетривіальний об'єкт, а в разі більшої кількості точок ці фігури потрібно буде вміти швидко перетинати.