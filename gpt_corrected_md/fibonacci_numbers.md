# Числа Фібоначчі

## Визначення

Послідовність Фібоначчі визначається наступним чином:

$$
F_0 = 0,
$$

$$
F_1 = 1,
$$

$$
F_n = F_{n-1} + F_{n-2}.
$$

Кілька перших її членів:

$$
0, ~ 1, ~ 1, ~ 2, ~ 3, ~ 5, ~ 8, ~ 13, ~ 21, ~ 34, ~ , ~ 55, ~ 89, ~ \ldots
$$

## История

Ці числа були введені у 1202 році Леонардо Фібоначчі (також відомий як Леонардо Пізанський). Однак саме завдяки математику 19 століття Люку (Lucas) назва "числа Фібоначчі" стала загальновживаною.

Однак, індійські математики згадували числа цієї послідовності ще раніше: Гопала (Gopala) до 1135 р., Хемачандра (Hemachandra) - в 1150 р.

## Числа Фібоначчі в природе

Сам Фібоначчі згадував ці числа у зв'язку з завданням: "Людина посадила пару кроликів в загон, оточений з усіх боків стіною. Скільки пар кроликів можна отримати за рік з цієї пари, якщо відомо, що кожного місяця кожна пара кроликів народжує ще одну пару?". Розв'язком цієї задачі є числа послідовності, яку нині називають на його честь. Однак описана Фібоначчі ситуація - це скоріше гра розуму, ніж реальна природа.

Індійські математики Гопала і Хемачандра згадували числа цієї послідовності у зв'язку з кількістю ритмічних малюнків, які утворюються при чергуванні довгих і коротких складів у віршах або сильних і слабких частин у музиці. Кількість таких малюнків, що мають усього $n$ частин, дорівнює $F_n$.

Числа Фібоначчі з'явилися в роботі Кеплера 1611 року, який розмірковував про числа, які зустрічаються в природі (робота "Про шестикутних сніжинках").

Цікавий приклад рослини - тисячелистника, у якої кількість стебел (а отже і квітів) завжди є числом Фібоначчі. Причина цього проста: спочатку вона має один стебло, який потім ділиться на два, потім з головного стебла відходить ще один, потім перші два стебла знову розгалужуються, потім всі стебла, крім двох останніх, розгалужуються, і так далі. Таким чином, кожен стебло після свого з'явлення "пропускає" одне розгалуження, а потім починає ділитися на кожному рівні розгалужень, що й дає в результаті числа Фібоначчі.

Взагалі кажучи, у багатьох квітів (наприклад, лілія) число пелюсток є певним числом Фібоначчі.

Також у ботаніці відоме явище ''філотаксису''. Наприклад, якщо подивитися зверху на розташування насіння підсонця, можна побачити одночасно дві серії спіралей (ніби накладених одна на одну): одні закручені за годинниковою стрілкою, інші - проти. Виявляється, що кількість цих спіралей приблизно збігається з двома послідовними числами Фібоначчі: 34 і 55 або 89 і 144. Аналогічні факти справедливі і для деяких інших квітів, а також для шишок сосни, броколі, ананасів і т.д.

Для багатьох рослин (за деякими даними, для 90% з них) вірний і цікавий факт. Розгляньмо який-небудь листок і будемо спускатися від нього вниз до тих пір, поки не досягнемо листка, розташованого на стеблі точно так само (тобто спрямованого точно в ту ж сторону). По дорозі будемо враховувати всі листки, які зустрінуться нам (тобто розташовані по висоті між стартовим листком і кінцевим), але розташовані по-іншому. Нумеруючи їх, ми будемо поступово здійснювати оберти навколо стебла (оскільки листки розташовані на стеблі по спіралі). Залежно від того, чи здійснювати оберти за годинниковою стрілкою, чи проти, буде виходити різна кількість обертів. Але виявляється, що кількість обертів, здійснених нами за годинниковою стрілкою, кількість обертів, здійснених проти годинникової стрілки, і кількість зустрінутих листків утворюють 3 послідовні числа Фібоначчі.

Проте слід відзначити, що існують рослини, для яких наведені вище розрахунки дають числа з зовсім інших послідовностей, тому не можна стверджувати, що явище філотаксису є законом - це скоріше цікава тенденція.

## Властивості

Числа Фібоначчі мають безліч цікавих математичних властивостей.

Ось лише кілька з них:

* Співвідношення Кассини: 

$$
F_{n+1} F_{n-1} - F_n^2 = (-1)^n.
$$

* Правило "складання": 

$$
F_{n+k} = F_k F_{n+1} + F_{k-1} F_n.
$$

* З попередньої рівності при $k = n$ випливає:

$$
F_{2n} = F_n (F_{n+1} + F_{n-1}).
$$

* З попереднього рівняння за індукцією можна отримати, що

$F_{nk}$ завжди кратне $F_n$.

* Правильне і протилежне до попередньому твердження:

якщо $F_m$ є кратним $F_n$, то $m$ є кратним $n$.

* НСД-рівність: 

$$
{\rm gcd} (F_m, F_n) = F_{{\rm gcd} (m, n)}.
$$

* За відношенням до алгоритму Євкліда числа Фібоначчі мають ту чудову властивість, що вони є найгіршими вхідними даними для цього алгоритму (див. "Теорема Ламе" у [алгоритмі Євкліда](https://uk.wikipedia.org/wiki/%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_%D0%95%D0%B2%D0%BA%D0%BB%D1%96%D0%B4%D0%B0)).

## Фібоначчівська система числення

Теорема Цекендорфа стверджує, що будь-яке натуральне число $n$ можна уявити єдиним чином у вигляді суми чисел Фібоначчі:

$$
N = F_{k_1} + F_{k_2} + \ldots + F_{k_r}
$$

де $k_1 \geq k_2+2$, $k_2 \geq k_3+2$,  $\ldots$,  $k_r \geq 2$ (тобто в записи не можна використовувати два сусідні у послідовності числа Фібоначчі).

Звідси випливає, що будь-яке число можна однозначно записати у **системі числення Фібоначчі**, наприклад:

$$
9 = 8+1 = F_6 + F_1 = (10001)_F,
$$

$$
6 = 5+1 = F_5 + F_1 = (1001)_F,
$$

$$
19 = 13+5+1 = F_7 + F_5 + F_1 = (101001)_F,
$$

причому ні в якому числі не можуть йти дві одиниці поспіль.

Не складно отримати правило додавання одиниці до числа в Фібоначчівій системі числення: якщо молодша цифра дорівнює 0, то її замінюємо на 1, а якщо дорівнює 1 (тобто в кінці маємо 01), то 01 замінюємо на 10. Потім "виправляємо" запис, послідовно замінюючи всюди 011 на 100. В результаті за лінійний час буде отриманий запис нового числа.

Переведення числа в систему числення Фібоначчі здійснюється за допомогою простого "жадібного" алгоритму: потрібно просто перебирати числа Фібоначчі від найбільшого до найменшого і, якщо деяке $F_k \leq n$, то $F_k$ входить до запису числа $n$. Після цього потрібно відняти $F_k$ від $n$ і продовжувати пошук.

## Формула для n-го числа Фібоначчі

### Формула через корені

Існує чудова формула, яка називається ім'ям французького математика Біне (Binet), хоча вона була відома ще до нього Муавру (Moivre):

$$
F_n = \frac{ \left( \frac{1+\sqrt{5}}{2} \right)^n - \left( \frac{1-\sqrt{5}}{2} \right)^n }{ \sqrt{5} }.
$$

Цю формулу легко довести по індукції, однак вивести її можна з допомогою понятия утворюють функцій або з допомогою розв'язку функционального рівняння.

Відразу можна замітити, що другий доданок завжди за модулем менший за 1, і, більше того, дуже швидко зменшується (експоненційно). Звідси випливає, що значення першого доданка дає "майже" значення $F_n$. Це можна записати у строгому вигляді:

$$
F_n = \left[ \frac{ \left( \frac{1+\sqrt{5}}{2} \right)^n }{ \sqrt{5} } \right],
$$

де квадратні дужки позначають округлення до найближчого цілого.

Втім, для практичного застосування в обчисленнях ці формули мало підходять, оскільки вимагають дуже високої точності роботи з дробовими числами.

### Матрична формула для чисел Фібоначчі

Не складно довести матричну рівність:

$$
\begin{pmatrix}
F_{n-2} & F_{n-1} \cr
\end{pmatrix} \cdot \begin{pmatrix}
0 & 1 \cr
1 & 1 \cr
\end{pmatrix} = \begin{pmatrix}
F_{n-1} & F_{n} \cr
\end{pmatrix}.
$$

Але тоді, позначаючи

$$
P \equiv
\begin{pmatrix}
0 & 1 \cr
1 & 1 \cr
\end{pmatrix},
$$

отримуємо:

$$
\begin{pmatrix}
F_0 & F_1 \cr
\end{pmatrix} \cdot P^n = \begin{pmatrix}
F_{n} & F_{n+1} \cr
\end{pmatrix}.
$$

Таким чином, для знаходження $n$-го числа Фібоначчі потрібно піднести матрицю $P$ до степеня $n$.

Згадуючи, що піднесення матриці до $n$-ої ступені можна здійснити за $O(\log n)$ (див. [Бінарне піднесення до ступеня](binary_pow)), випливає, що $n$-те число Фібоначчі можна легко обчислити за $O(\log n)$ з використанням тільки цілочисельної арифметики.

## Періодичність послідовності Фібоначчі за модулем

Розглянемо послідовність Фібоначчі $F_i$ по деякого модулю $p$. Доведемо, що вона є періодичної, і причому период починається з $F_1=1$ (тобто предпериод містить тільки $F_0$).

Доведемо це за допомогою доказу від супротивного. Розглянемо $p^2+1$ пару чисел Фібоначчі, взятих за модулем $p$:

$$
(F_1,F_2),\ (F_2,F_3),\ \ldots,\ (F_{p^2+1},F_{p^2+2}).
$$

Оскільки за модулем $p$ можливо бути тільки $p$ різних залишків, то серед цієї послідовності знайдеться як мінімум два однакові залишки. Це вже означає, що послідовність періодична.

Виберемо серед усіх таких однакових пар дві пари з найменшими номерами. Нехай це будуть пари з деякими номерами $(F_a,F_{a+1})$ і $(F_b,F_{b+1})$. Доведемо, що $a=1$. Дійсно, в іншому випадку для них знайдуться попередні пари $(F_{a-1},F_a)$ і $(F_{b-1},F_b)$, які, за властивістю чисел Фібоначчі, також будуть рівні одна одній. Однак це суперечить тому, що ми вибрали пари з найменшими номерами, які співпадають, що і потрібно довести.

## Література

* \book{Рональд Грехем, Дональд Кнут, Орен Паташник}{Конкретна математика}{1998}{graham.djvu}