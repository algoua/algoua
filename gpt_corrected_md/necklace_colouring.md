# Намиста

Задача "ожерело" - це одна з класичних комбінаторних задач. Потрібно порахувати кількість різних намист з $n$ бусинок, кожна з яких може бути пофарбована в один з $k$ кольорів. При порівнянні двох намист їх можна повертати, але не можна перевертати (тобто дозволяється зробити циклічний зсув).

## Розв'язок

Розв'язати цю задачу можна, використовуючи лему Бернсайда і теорему Пойа (див. статтю про лему Бернсайда і теорему Пойа). Нижче наведено копію тексту з цієї статті

У цій задачі ми можемо зразу знайти групу інваріантних перестановок. Очевидно, що вона буде складатись з $n!$ перестановок:

$$
\pi_0 = 1\ 2\ 3\ \ldots\ n
$$

$$
\pi_1 = 2\ 3\ \ldots\ n\ 1
$$

$$
\pi_2 = 3\ \ldots\ n\ 1\ 2
$$

$$
\ldots
$$

$$
\pi_{n-1} = n\ 1\ 2\ \ldots\ (n-1)
$$

Знайдемо явну формулу для обчислення $C(\pi_i)$. По-перше, зауважимо, що перестановки мають такий вигляд, що в $i$-ій перестановці на $j$-ій позиції стоїть число $i+j$ (взяте за модулем $n$, якщо воно більше $n$). Якщо ми будемо розглядати циклічну структуру $i$-ої перестановки, то побачимо, що одиниця переходить в $1+i$, $1+i$ переходить в $1+2i$, $1+2i$ - в $1+3i$, і так далі, поки не прийдемо до числа $1 + kn$; для інших елементів виконуються схожі заяви. Звідси можна зрозуміти, що всі цикли мають однакову довжину, рівну ${\rm lcm}(i,n) / i$, тобто $n / {\rm gcd}(i,n)$ ("gcd" - найбільший спільний дільник, "lcm" - найменше спільне кратне). Отже, кількість циклів в $i$-ій перестановці буде рівна просто ${\rm gcd}(i,n)$.

Підставляючи знайдені значення до теореми Пуанкаре, отримуємо **розв'язок**:

$$
{\rm Ans} = \frac{1}{n} \sum_{i=1}^{n} k ^ {{\rm gcd}(i,n)}
$$

Можна залишити формулу в такому вигляді, але можна її ще більше спростити. Перейдемо від суми по всім $i$ до суми тільки по дільниках $n$. Дійсно, в нашій сумі буде багато однакових доданків: якщо $i$ не є дільником $n$, то такий дільник знайдеться після обчислення ${\rm НСД}(i,n)$. Отже, для кожного дільника $d|n$ його доданок $k^{{\rm НСД}(d,n)} = k^d$ врахується декілька разів, тому суму можна записати в наступному вигляді:

$$
{\rm Ans} = \frac{1}{n} \sum_{d|n} C_d k^d
$$

де $C_d$ - це кількість таких чисел $i$, для яких ${\rm gcd}(i,n) = d$. Знайдемо явний вираз для цієї кількості. Будь-яке таке число $i$ має вигляд: $i=dt$, де ${\rm gcd}(t,n/d) = 1$ (інакше ${\rm gcd}(i,n) > d$). Згадуючи [функцію Ойлера](euler_function), ми знаходимо, що кількість таких $t$ дорівнює значенню функції Ойлера $\phi(n/d)$. Таким чином, $C_d = \phi(n/d)$, і остаточно отримуємо **формулу**:

$$
{\rm Ans} = \frac{1}{n} \sum_{d|n} \phi \left( \frac{n}{d} \right) k^d
$$