# Задача Джонсона з однією машиною

Це задача складання оптимального розкладу обробки $n$ деталей на єдиному верстаті, якщо $i$-та деталь обробляється на ньому протягом часу $t_i$, а за $t$ секунд очікування до обробки цієї деталі платиться штраф $f_i(t)$.

Таким чином, задача полягає у пошуку такого переупорядкування деталей, щоб наступна величина (розмір штрафу) була мінімальною. Якщо ми позначимо через $\pi$ перестановку деталей ($\pi_1$ - номер першої оброблюваної деталі, $\pi_2$ - другої, і т.д.), то розмір штрафу $f(\pi)$ дорівнює:

$$
F(\pi) = f_{\pi_1}(0) + f_{\pi_2}(t_{\pi_1}) + f_{\pi_3}(t_{\pi_1} + t_{\pi_2}) + \ldots + f_{\pi_n}\left(\sum_{i=1}^{n-1} t_{\pi_i}\right).
$$

Іноді цю задачу називають завданням обслуговування множини заявок одним процесором.

## Розв'язок задачі у деяких часткових випадках

### Перший приватний випадок: лінійні функції штрафу

Навчимося розв'язувати цю задачу у випадку, коли всі $f_i(t)$ є лінійними, тобто мають вигляд:

$$
f_i(t) = c_i \cdot t,
$$

де $c_i$ - невід'ємні числа. Зауважимо, що в цих лінійних функціях вільний член дорівнює нулю, тобто в іншому випадку до відповіді можна зразу додати цей вільний член і розв'язувати задачу з нульовим вільним членом.

Зафіксуємо деякий розклад - перестановку $\pi$. Зафіксуємо якийсь номер $i=1 \ldots n-1$, і нехай перестановка $\pi^\prime$ дорівнює перестановці $\pi$, в якій обміняли $i$-й і $(i+1)$-й елементи. Подивимося, на скільки змінився штраф при цьому

$$
F(\pi^\prime) - F(\pi) =
$$

легко зрозуміти, що зміни сталися тільки з $i$-м та $i+1$-м доданками:

$$
= c_{\pi^\prime_i} \cdot \sum_{k=1}^{i-1} t_{\pi^\prime_k} + c_{\pi^\prime_{i+1}} \cdot \sum_{k=1}^{i} t_{\pi^\prime_k} - c_{\pi_i} \cdot \sum_{k=1}^{i-1} t_{\pi_k} - c_{\pi_{i+1}} \cdot \sum_{k=1}^{i} t_{\pi_k} =
$$

$$
= c_{\pi_{i+1}} \cdot \sum_{k=1}^{i-1} t_{\pi^\prime_k} + c_{\pi_i} \cdot \sum_{k=1}^{i} t_{\pi_k^\prime} - c_{\pi_i} \cdot \sum_{k=1}^{i-1} t_{\pi_k} - c_{\pi_{i+1}} \cdot \sum_{k=1}^{i} t_{\pi_k} =
$$

$$
= c_{\pi_i} \cdot t_{\pi_{i+1}} - c_{\pi_{i+1}} \cdot t_{\pi_i}.
$$

Зрозуміло, що якщо розклад $\pi$ є оптимальним, то будь-яка його зміна призводить до збільшення штрафу (або збереження попереднього значення), тому для оптимального плану можна записати умову:

$$
\forall i=1 \ldots n-1 ~~~:~~ c_{\pi_i} \cdot t_{\pi_{i+1}} - c_{\pi_{i+1}} \cdot t_{\pi_i} \ge 0.
$$

Перетворюючи, отримуємо:

$$
\forall i=1 \ldots n-1 ~~~:~~ \frac{ c_{\pi_i} }{ t_{\pi_i} } \ge \frac{ c_{\pi_{i+1}} }{ t_{\pi_{i+1}} }.
$$

Таким чином, **оптимальний розклад** можна отримати, просто **відсортувавши** всі деталі за відношенням $c_i$ до $t_i$ в зворотному порядку.

Слід зазначити, що ми отримали цей алгоритм так званим **перестановним прийомом**: ми спробували обміняти місцями два сусідні елементи розкладу, обчислили, наскільки змінився штраф, і звідси вивели алгоритм пошуку оптимального розкладу.

### Другий приватний випадок: експоненційні функції штрафу

Нехай тепер функції штрафу мають вигляд:

$$
f_i(t) = c_i \cdot e^{\alpha \cdot t},
$$

де всі числа $c_i$ не від'ємні, константа $\alpha$ позитивна.

Значить, застосовуючи аналогічний метод тут перестановки, легко отримати, що деталі потрібно сортувати в порядку спадання величин:

$$
v_i = \frac{ 1 - e^{ \alpha \cdot t_i } }{ c_i }.
$$

### Третій приватний випадок: однакові монотонні функції штрафу

У цьому випадку припускається, що всі $f_i(t)$ збігаються до деякої функції $\phi(t)$, яка є зростаючою.

Зрозуміло, що в цьому випадку оптимально розташовувати деталі в порядку збільшення часу обробки $t_i$.

## Теорема Лівшиця-Кладова

Теорема Лівшиця-Кладова встановлює, що перестановочний прийом можна застосувати тільки до вищеописаних трьох часткових випадків і лише до них, тобто:

* Лінійний випадок: $f_i(t) = c_i \cdot t + d_i$, де $c_i$ - невід'ємні константи
* Експоненційний випадок: $f_i(t) = c_i \cdot e^{\alpha \cdot t} + d_i$, де $c_i$ і $\alpha$ - позитивні константи
* Тотожній випадок: $f_i(t) = \phi(t)$, де $\phi$ - зростаюча функція.

Ця теорема доведена з припущенням, що функції штрафу є достатньо гладкими (існують треті похідні).

У всіх трьох випадках застосуємо перестановний прийом, завдяки якому шуканий оптимальний розклад можна знайти простим сортуванням, отже, за час $O(n \log n)$.